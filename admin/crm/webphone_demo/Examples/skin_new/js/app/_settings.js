define(["jquery","common","stringres","global","plhandler"],function(x,r,h,b,E){var K=true;var L="";var D=false;function z(N){try{r.PutToDebugLog(4,"_settings: onCreate");x("#settings_list").on("click","li",function(O){F(x(this).attr("id"))});x(window).resize(function(){if(x.mobile.activePage.attr("id")==="page_settings"){d()}});x("#settings_menu_ul").on("click","li",function(O){q(x(this).attr("id"))});x("#btn_settings_menu").on("click",function(){n("#settings_menu_ul")});x("#btn_settings_menu").attr("title",h.get("hint_menu"));x("#btn_back_settings").attr("title",h.get("hint_btnback"));x("#btn_back_settings").on("click",function(O){J(O)})}catch(M){r.PutToDebugLogException(2,"_settings: onCreate",M)}}function f(N){try{if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){r.WinAPI("API_GuiStarted",function(O){r.PutToDebugLog(2,"EVENT, _settings API_GuiStarted response: "+O)})}r.PutToDebugLog(4,"_settings: onStart");b.isSettingsStarted=true;x("#settings_list").prev("form.ui-filterable").hide();if(!r.isNull(document.getElementById("settings_page_title"))){document.getElementById("settings_page_title").innerHTML=h.get("settings_title")}x(".separator_line_thick").css("background-color",r.HoverCalc(r.getBgColor("#settings_header"),-30));if(r.IsIeVersion(10)){x("#settings_list").children().css("line-height","normal")}x("#btn_back_settings").hide();if(r.GetParameter("settlevelbasic")==="false"){K=false}else{K=true}L=r.GetIntentParam(b.intentsettings,"startedfrom");if(r.isNull(L)){L=""}d();t=false;A()}catch(M){r.PutToDebugLogException(2,"_settings: onStart",M)}}function d(){try{var O=r.GetDeviceHeight()-x("#settings_header").height()-3;if(D){var N=r.StrToIntPx(x(".ui-input-search").css("margin-top"));O=O-x("#settings_list").prev("form.ui-filterable").height()-N-N}x("#settings_list").height(O)}catch(M){r.PutToDebugLogException(2,"_settings: MeasureSettingslist",M)}}var e="serveraddress_user,sipusername,password,submenu_sipsettings,submenu_media,submenu_calldivert,submenu_general,username,displayname,hidemyidentity,usetunneling,transport,proxyaddress,use_stun,use_rport,register,registerinterval,keepalive,natopenpackets,ringtimeout,calltimeout,dtmfmode,chatsms,prack,sendearlymedia,sendrtponmuted,defmute,changesptoring,localip,signalingport,rtpport,capabilityrequest,customsipheader,techprefix,callforwardonbusy,autoanswer_forward,rejectonvoipbusy,voicemail,callback_accessnumber,transfertype,automute,autohold,enableaudio,balance_uri,rating_uri,p2p_uri,callback_uri,sms_uri,dialerintegration,integrateifwifionly,nativefilterallow,nativefilterblock,displaynotification,displayvolumecontrols,displayaudiodevice,savetocontacts,androidvoicerecording,email,reset_settings,log,loglevel,playring,cfgvideo,video_profile,use_h263,use_h264,video_fps,codec,setfinalcodec,aec_orig,denoise_orig,agc_orig,plc_orig,silencesupress,hardwaremedia,volumein,volumeout,setqos,codecframecount,doublesendrtp,jittersize,audiobufferlength,speakermode";var g="serveraddress_user,sipusername,password,submenu_sipsettings,submenu_media,submenu_calldivert,submenu_general,username,displayname,hidemyidentity,usetunneling,transport,proxyaddress,use_stun,use_rport,register,registerinterval,keepalive,natopenpackets,ringtimeout,calltimeout,dtmfmode,chatsms,prack,sendearlymedia,sendrtponmuted,defmute,changesptoring,localip,signalingport,rtpport,capabilityrequest,customsipheader,techprefix,callforwardonbusy,autoanswer_forward,rejectonvoipbusy,voicemail,callback_accessnumber,transfertype,automute,autohold,enableaudio,balance_uri,rating_uri,p2p_uri,callback_uri,sms_uri,startwithos,dialerintegration,integrateifwifionly,nativefilterallow,nativefilterblock,displaynotification,displayvolumecontrols,displayaudiodevice,savetocontacts,androidvoicerecording,email,reset_settings,log,loglevel,playring,cfgvideo,video_profile,use_h263,use_h264,video_fps,codec,setfinalcodec,aec_orig,denoise_orig,agc_orig,plc_orig,silencesupress,hardwaremedia,volumein,volumeout,setqos,codecframecount,doublesendrtp,jittersize,audiobufferlength,speakermode";var v="settobasefunctionality,serveraddress_user,sipusername,password,submenu_sipsettings,submenu_calldivert,submenu_general,submenu_integrate,username,displayname,usetunneling,transport,proxyaddress,use_stun,register,registerinterval,keepalive,ringtone,filters,callforwardonbusy,autoanswer_forward,rejectonvoipbusy,rejectonphonebusy,startonboot,dialerintegration,integrateifwifionly,nativefilterallow,nativefilterblock,androidvoicerecording,email,cpualwayspartiallock,forcewifi,reset_settings,accounts,log,new_user_artcl,recharge_artcl";var C="displayname,usetunneling,ringtone,startonboot,submenu_integrate,dialerintegration";var w=0;var t=false;function A(){r.PutToDebugLog(3,"DEBUG, _settings GetAccounts called");try{if(r.isNull(b.aclist)||(b.aclist).length<1){r.PutToDebugLog(3,"DEBUG, _settings readaccounts");r.ReadAccountsFile(function(N){r.PutToDebugLog(3,"DEBUG, _settings GetAccounts callback");if(!N){r.PutToDebugLog(3,"DEBUG, _settings GetAccounts callback no content_1");r.InitializeSettings();r.PutToDebugLog(3,"DEBUG, _settings GetAccounts callback no content_2");r.GetSettingsFromUrl();r.PutToDebugLog(3,"DEBUG, _settings GetAccounts callback no content_3");B();r.PutToDebugLog(3,"DEBUG, _settings GetAccounts callback no content_4")}else{r.PutToDebugLog(3,"DEBUG, _settings GetAccounts callback read successfull");if(!r.isNull(r.settmap)){for(var O in r.settmap){delete r.settmap[O]}}t=true;G()}})}else{r.PutToDebugLog(3,"DEBUG, _settings GetAccounts aclist exists");t=true;G()}}catch(M){r.PutToDebugLogException(2,"_settings: GetAccounts",M)}}function G(){r.PutToDebugLog(3,"DEBUG, _settings GetSettings called");try{for(var N in r.settmap){r.PutToDebugLog(2,"SETT: "+N+" = "+r.settmap[N])}if(r.isNull(r.settmap)||r.isNull(r.settmap.magicnumber)){var M=r.GetActiveAccSettingsFilename();r.PutToDebugLog(3,"DEBUG, _settings GetSettings settfilename: "+M);if(r.isNull(M)||M.length<2){r.PutToDebugLog(3,"DEBUG, _settings GetSettings InitializeSettings called");r.InitializeSettings()}else{r.PutToDebugLog(3,"DEBUG, _settings GetSettings ReadSettingsFile");r.ReadSettingsFile(M,function(P){r.PutToDebugLog(3,"DEBUG, _settings GetSettings callback");if(!P){r.PutToDebugLog(3,"DEBUG, _settings GetSettings ReadSettings no content");r.InitializeSettings()}r.GetSettingsFromUrl();B()})}}else{r.PutToDebugLog(3,"DEBUG, _settings GetSettings settmap exists");r.GetSettingsFromUrl();B()}}catch(O){r.PutToDebugLogException(2,"_settings: GetSettings",O)}}function B(){r.PutToDebugLog(3,"DEBUG, _settings AutoStart called");try{if(L!=="app"){var M=false;var Q=r.GetParameter("serveraddress_user");var N=r.GetParameter("upperserver");var R=r.GetParameter("sipusername");var P=r.GetParameter("password");if(wphone.treatuserserverinputasupperserver==="true"){if(!r.isNull(N)&&N.length>2&&!r.isNull(R)&&R.length>2&&!r.isNull(P)&&P.length>2){M=true}}else{if(b.customizedversion){if(!r.isNull(R)&&R.length>2&&!r.isNull(P)&&P.length>2){M=true}}else{if(!r.isNull(Q)&&Q.length>2&&!r.isNull(R)&&R.length>2&&!r.isNull(P)&&P.length>2){M=true}}}if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){r.WinAPI("API_GuiStarted",function(S){r.PutToDebugLog(2,"EVENT, _settings API_GuiStarted response: "+S)})}if(M){x.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"});if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){setTimeout(function(){webphone_public.webphone_started=false;webphone_public.StartWin()},100)}else{setTimeout(function(){wphone.start(r.GetParameter("sipusername"),r.GetParameter("password"))},500)}return}else{I()}}else{I()}}catch(O){r.PutToDebugLogException(2,"_settings: AutoStart",O)}}function I(){try{if(r.isNull(document.getElementById("settings_list"))){r.PutToDebugLog(2,"ERROR, _settings: PopulateList listelement is null");return}r.PutToDebugLog(2,"EVENT, _settings Starting populate list");var ac="";var U=h.get("newuser_uri");if(b.customizedversion&&!r.isNull(U)&&U.length>2&&L!=="app"){var O='<li id="newuser_container"><button id="btn_newuser" class="ui-btn ui-btn-corner-all ui-btn-b noshadow">'+h.get("newuser")+"</button></li>";ac=ac+O}var Q="";if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){r.PutToDebugLog(2,"EVENT, settings: Device: Windows softphone");Q=g}else{r.PutToDebugLog(2,"EVENT, settings: Device: browser webphone");Q=e}var S=0;while(Q.length>0&&S<5000){S++;var P="";var T=Q.indexOf(",");if(T<=0){if(Q.length>0){T=Q.length}else{break}}var ae=Q.substring(0,T);if(T+1<Q.length){Q=(r.Trim(Q.substring(T+1)))}else{Q=""}if(r.isNull(ae)||ae.length<1){continue}var Y=r.settmap[ae];if(r.isNull(Y)){continue}var ad=Y[r.SETT_VALUE];var N=Y[r.SETT_TYPE];var aa=Y[r.SETT_ISDEFAULT];var af=0;try{af=r.StrToInt(r.Trim(Y[r.SETT_GROUP]));if(r.isNull(af)){af=0}}catch(Z){r.PutToDebugLogException(3,"_settings: populateList settGrouping can't be converted to integer",Z)}if(!D){if(af!==w&&ae!=="accounts"&&ae!=="ringtone"){continue}if(K&&v.indexOf(ae)<0){continue}}var ab=h.get("sett_display_name_"+ae);var X=h.get("sett_comment_"+ae);var V=h.get("sett_comment_short_"+ae);if(ae==="loglevel"&&r.GetParameter("log")==="false"){continue}if(r.isNull(N)||N.length<1||(N!=="0"&&N!=="1"&&N!=="2"&&N!=="3"&&N!=="4"&&N!=="5"&&N!=="6"&&N!=="7"&&N!=="8")){if(N!=="-1"){r.PutToDebugLog(2,"ERROR, _settings: "+N+" is incorrectly defined in InitializeSettings")}continue}if(b.customizedversion){if(ae==="serveraddress_user"){continue}if(L!=="app"&&ae!=="sipusername"&&ae!=="password"){continue}}if(!b.customizedversion&&(ae==="serveraddress_user"||ae==="sipusername"||ae==="password")){ab="*<b>"+ab+"</b>"}else{if(C.indexOf(ae)<0){}else{ab="<b>"+ab+"</b>"}}var M="";if(aa==="0"){M=l(ae)+" "+c(ae)}else{M=l(ae)}if(wphone.treatuserserverinputasupperserver==="true"){if(ae==="serveraddress_user"){M=l(ae)+" "+c(ae)}if(ae==="transport"){continue}}P='<li data-icon="[SETTICON]" id="[ITEMID]"><a class="noshadow"><div class="sett_text"><span class="sett_display_name">[DISPLAYNAME]</span><br><span id="[COMMENTID]" class="sett_comment">[COMMENT]</span></div>[TRUEFALSEIMG]</a></li>';if(N==="0"){if(ae==="use_h263"||ae==="use_h264"){if(ad==="1"){P=P.replace("[TRUEFALSEIMG]",'<div class="sett_image"><img src="images/checkbox_false.png" id="img_'+ae+'" /></div>')}else{P=P.replace("[TRUEFALSEIMG]",'<div class="sett_image"><img src="images/checkbox_true.png" id="img_'+ae+'" /></div>')}}else{if(ad==="true"){P=P.replace("[TRUEFALSEIMG]",'<div class="sett_image"><img src="images/checkbox_true.png" id="img_'+ae+'" /></div>')}else{P=P.replace("[TRUEFALSEIMG]",'<div class="sett_image"><img src="images/checkbox_false.png" id="img_'+ae+'" /></div>')}}P=P.replace("[SETTICON]","false")}else{P=P.replace("[TRUEFALSEIMG]","")}if(N==="1"||N==="2"||N==="3"||N==="4"||N==="5"||N==="7"||N==="8"){P=P.replace("[SETTICON]","carat-d")}if(N==="6"){P=P.replace("[SETTICON]","carat-r")}P=P.replace("[ITEMID]","settingitem_"+ae);P=P.replace("[DISPLAYNAME]",ab);P=P.replace("[COMMENT]",M);P=P.replace("[COMMENTID]","sett_comment_"+ae);ac=ac+P}}catch(R){r.PutToDebugLogException(2,"_settings: PopulateList",R)}var W='<li id="settings_footer"><button id="btn_login" class="ui-btn ui-btn-corner-all ui-btn-b noshadow">'+h.get("btn_login")+"</button></li>";if(w===r.StrToInt(r.GROUP_MAIN)){ac=ac+W}x("#settings_list").html("");x("#settings_list").append(ac).listview("refresh");x("#btn_login").on("click",function(){a()});x("#btn_cancel").on("click",function(){alert("Cancel")});x("#btn_newuser").on("click",function(ag){k()});r.PutToDebugLog(2,"EVENT, _settings List populated")}function F(ap){try{if(r.isNull(ap)||ap.length<1){r.PutToDebugLog(2,"ERROR, _settings OnListItemClick id is NULL");return}if(ap==="settings_footer"||ap==="newuser_container"){return}b.wasSettModified=true;var ax=ap.replace("settingitem_","");var av=r.settmap[ax];if(r.isNull(av)||av.length<1){r.PutToDebugLog(2,"ERROR, _settings OnListItemClick settings NULL");return}var al=av[r.SETT_VALUE];var T=av[r.SETT_TYPE];var ai=av[r.SETT_ALLNAMES];var ar=av[r.SETT_ALLVALUES];var ao=av[r.SETT_GROUP];var ad=h.get("sett_display_name_"+ax);var X=h.get("sett_comment_"+ax);if(T===null||T.length<=0||(T!=="0"&&T!=="1"&&T!=="2"&&T!=="3"&&T!=="4"&&T!=="5"&&T!=="6"&&T!=="7"&&T!=="8")){r.PutToDebugLog(2,"ERROR, _settings OnListItemClick invalid type");return}var U=r.GetDeviceWidth();if(!r.isNull(U)&&r.IsNumber(U)&&U>100){U=Math.floor(U/1.2)}else{U=220}if(T==="0"){if(ax==="use_h263"){if(al==="1"){al="2"}else{al="1"}}else{if(ax==="use_h264"){if(al==="1"){al="3"}else{al="1"}}else{if(al==="true"){al="false"}else{al="true"}}}var O="";O=x("#img_"+ax).attr("src");if(r.isNull(O)||O.lenght<1){r.PutToDebugLog(2,"ERROR, _settings imgsrc NULL");return}if(O.indexOf("true")>=0){O=O.replace("true","false")}else{O=O.replace("false","true")}x("#img_"+ax).attr("src",O);av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax);if(ax==="log"){if(al==="true"){r.SaveParameter("loglevel",b.predefLoglevel);r.SaveParameter("jsscriptevent","3");wphone.setparameter("jsscriptevent","3");r.SaveParameter("loglastusage",r.GetTickCount());I()}else{r.SaveParameter("loglevel","1");r.SaveParameter("jsscriptevent","2");wphone.setparameter("jsscriptevent","2");I()}}}if(T==="1"){var Q='<div id="settings_type_1" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+U+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+X+'</span><input type="text" id="setting_item_input" name="setting_item" data-theme="a"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+h.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+h.get("btn_cancel")+"</a></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();x("#adialog_positive").off("click");x("#adialog_negative").off("click");af()}});var P=0;x("#settings_type_1").keypress(function(aD){P++;if(aD.which===13&&P<2){aD.preventDefault();x("#adialog_positive").click()}else{return}});var N=document.getElementById("setting_item_input");if(!r.isNull(al)&&al.length>0&&!r.isNull(N)){if(ax==="password"){N.value="*****"}else{if((ax==="ringtimeout"||ax==="calltimeout")&&(ax.length>3)){al=al.substring(0,al.length-3);N.value=al}else{N.value=al}}}if(!r.isNull(N)){N.focus()}x("#adialog_positive").on("click",function(aF){r.PutToDebugLog(5,"EVENT, settings onListItemClick 1 ok");var aE="";if(!r.isNull(N)){aE=N.value}if(!r.isNull(aE)){if(ax==="ringtimeout"||ax==="calltimeout"){aE=aE+"000"}al=r.Trim(aE);if(ax==="sipusername"){r.SaveParameter("username",al)}if(ax==="loglevel"){if(r.isNull(al)||al.length<1){al="1"}var aD=1;try{aD=r.StrToInt(al)}catch(aG){}b.loglevel=aD}if(ax==="password"&&aE.indexOf("**")>=0){return}av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax)}});x("#adialog_negative").on("click",function(aD){})}if(T==="2"){var au=ai;var an=ar;var S=0;var ac=au;while(ac.indexOf(",")>0){ac=ac.substring(ac.indexOf(",")+1,ac.length);S++}S++;var W;var ah;if(K&&ax==="transport"&&!r.isNull(al)&&al.length>0&&(al==="0"||al==="1")){W=["UDP","TCP"];ah=["0","1"]}else{W=[];ah=[];var aA=0;ac=au;while(aA<S){if(ac.indexOf(",")>0){W[aA]=ac.substring(0,ac.indexOf(","));ac=ac.substring(ac.indexOf(",")+1,ac.length)}else{W[aA]=ac.substring(0,ac.length)}aA++}aA=0;var aq=an;while(aA<S){if(aq.indexOf(",")>0){ah[aA]=aq.substring(0,aq.indexOf(","));aq=aq.substring(aq.indexOf(",")+1,aq.length)}else{ah[aA]=aq.substring(0,aq.length)}aA++}}var aw="";for(var aB=0;aB<W.length;aB++){var aj='<input name="'+ax+'" id="[INPUTID]" value="[VALUE]" [CHECKED] type="radio"><label for="[INPUTID]">[LABEL]</label>';aj=aj.replace("[INPUTID]",ax+"_"+aB);aj=aj.replace("[INPUTID]",ax+"_"+aB);aj=aj.replace("[VALUE]",ah[aB]);aj=aj.replace("[LABEL]",W[aB]);if(ah[aB]===al){aj=aj.replace("[CHECKED]",'checked="checked"')}else{aj=aj.replace("[CHECKED]","")}aw=aw+aj}var Q='<div id="settings_type_2" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+U+"px; min-width: "+Math.floor(U*0.6)+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content_select"><fieldset id="settings_select_2" data-role="controlgroup">'+aw+"</fieldset></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();af()}});var P=0;x("#settings_type_2").keypress(function(aD){P++;if(aD.which===13&&P<2){aD.preventDefault();x("#adialog_positive").click()}else{return}});x(":radio").on("change",function(aD){x.mobile.activePage.find(".messagePopup").popup("close");al=x(this).attr("value");av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax)})}if(T==="3"){var at=ai;var am=ar;var V=at.split(",");var ag=am.split(",");var aa=al.split(",");for(var ay=0;ay<aa.length;ay++){if(aa[ay]==="-1"){aa=["-1"];break}}var aw="";for(var aB=0;aB<V.length;aB++){var aj='<input name="'+ax+'" id="[INPUTID]" value="[VALUE]" [CHECKED] type="checkbox"><label for="[INPUTID]">[LABEL]</label>';aj=aj.replace("[INPUTID]",ax+"_"+aB);aj=aj.replace("[INPUTID]",ax+"_"+aB);aj=aj.replace("[VALUE]",ag[aB]);aj=aj.replace("[LABEL]",V[aB]);if(V[aB]==="Optimal"){for(var az=0;az<aa.length;az++){if(aa[az]==="-1"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="PCMU"){for(var az=0;az<aa.length;az++){if(aa[az]==="1"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="PCMA"){for(var az=0;az<aa.length;az++){if(aa[az]==="2"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="GSM"){for(var az=0;az<aa.length;az++){if(aa[az]==="3"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="iLBC"){for(var az=0;az<aa.length;az++){if(aa[az]==="4"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="SPEEX"){for(var az=0;az<aa.length;az++){if(aa[az]==="5"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="SPEEX-WB"){for(var az=0;az<aa.length;az++){if(aa[az]==="6"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}if(V[aB]==="G.729"){for(var az=0;az<aa.length;az++){if(aa[az]==="8"){aj=aj.replace("[CHECKED]",'checked="checked"');break}}aj=aj.replace("[CHECKED]","");aw=aw+aj}}var Q='<div id="settings_type_3" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" data-dismissible="false" style="max-width:'+U+"px; min-width: "+Math.floor(U*0.6)+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content_select"><fieldset id="settings_select_3" data-role="controlgroup">'+aw+'</fieldset></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" style="width: 98%;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+h.get("btn_ok")+"</a></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();x("#adialog_positive").off("click");af()}});var P=0;x("#settings_type_3").keypress(function(aD){P++;if(aD.which===13&&P<2){aD.preventDefault();x("#adialog_positive").click()}else{return}});x(":checkbox").on("change",function(aE){var aF=x(this).attr("value");if(aF==="-1"){if(x("#"+ax+"_0").prop("checked")){for(var aD=1;aD<V.length;aD++){x("#"+ax+"_"+aD).prop("checked",false).checkboxradio("refresh")}}else{for(var aD=0;aD<V.length;aD++){if(V[aD]==="PCMU"||V[aD]==="PCMA"||V[aD]==="GSM"){x("#"+ax+"_"+aD).prop("checked",true).checkboxradio("refresh")}}}}else{x("#"+ax+"_0").prop("checked",false).checkboxradio("refresh")}});x("#adialog_positive").on("click",function(aF){r.PutToDebugLog(5,"EVENT, settings onListItemClick 3 ok");al="";for(var aE=0;aE<V.length;aE++){if(x("#"+ax+"_"+aE).prop("checked")){var aD="";if(al.length>0){aD=","}al=al+aD+document.getElementById(ax+"_"+aE).value}}av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax)})}if(T==="4"){var Q='<div id="settings_type_4" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+U+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+X+'</span><input type="text" id="setting_item_input" name="setting_item" data-theme="a"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+h.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+h.get("btn_cancel")+"</a></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();x("#adialog_positive").off("click");x("#adialog_negative").off("click");af()}});var P=0;x("#settings_type_4").keypress(function(aD){P++;if(aD.which===13&&P<2){aD.preventDefault();x("#adialog_positive").click()}else{return}});var N=document.getElementById("setting_item_input");if(!r.isNull(al)&&al.length>0&&!r.isNull(N)){if((ax==="ringtimeout"||ax==="calltimeout")&&(ax.length>3)){al=al.substring(0,al.length-3);N.value=al}else{N.value=al}}if(!r.isNull(N)){N.focus()}x("#adialog_positive").on("click",function(aE){r.PutToDebugLog(5,"EVENT, settings onListItemClick 1 ok");var aD="";if(!r.isNull(N)){aD=N.value}if(!r.isNull(aD)&&aD.length>0){al=r.Trim(aD);av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax)}});x("#adialog_negative").on("click",function(aD){})}if(T==="5"){alert("not implemented yet")}if(T==="6"){x("#app_name_settings").hide();if(ax==="submenu_sipsettings"){w=r.StrToInt(r.Trim(r.GROUP_SIP));I();x("#btn_back_settings").show();x("#settings_page_title").html(ad);x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(ax==="submenu_media"){w=r.StrToInt(r.Trim(r.GROUP_MEDIA));I();x("#btn_back_settings").show();x("#settings_page_title").html(ad);x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(ax==="submenu_video"){w=r.StrToInt(r.Trim(r.GROUP_VIDEO));I();x("#btn_back_settings").show();x("#settings_page_title").html(ad);x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("sett_display_name_submenu_media"))}else{if(ax==="submenu_calldivert"){w=r.StrToInt(r.Trim(r.GROUP_CALLDIVERT));I();x("#btn_back_settings").show();x("#settings_page_title").html(ad);x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(ax==="submenu_general"){w=r.StrToInt(r.Trim(r.GROUP_GENERAL));I();x("#btn_back_settings").show();x("#settings_page_title").html(ad);x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(ax==="submenu_integrate"){w=r.StrToInt(r.Trim(r.GROUP_INTEGRATE));I();x("#btn_back_settings").show();x("#settings_page_title").html(ad);x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(ax==="submenu_advanced_artcl"){x("#btn_back_settings").show();w=6;I()}}}}}}}}if(T==="7"){alert("not implemented yet")}if(T==="8"){if(ax==="reset_settings"){var Q='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+U+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+h.get("reset_settings_msg")+'</span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+h.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+h.get("btn_cancel")+"</a></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();x("#adialog_positive").off("click");x("#adialog_negative").off("click");af()}});x("#adialog_positive").on("click",function(aD){r.PutToDebugLog(5,"EVENT, settings onListItemClick Reset Settings ok");var aE=r.GetParameter("username");var aG=r.GetParameter("password");var aF=r.GetParameter("serveraddress_orig");var aI=r.GetParameter("serveraddress_user");var aK=r.GetParameter("proxyaddress");var aL=r.GetParameter("sipusername");var aH=r.GetParameter("displayname");var aM=r.GetParameter("email");var aJ=r.GetParameter("voicemail");var aN=r.GetParameter("callforwardonbusy");for(var aO in r.settmap){delete r.settmap[aO]}r.InitializeSettings();r.SaveParameter("username",aE);r.SaveParameter("password",aG);r.SaveParameter("serveraddress_orig",aF);r.SaveParameter("serveraddress_user",aI);r.SaveParameter("proxyaddress",aK);r.SaveParameter("sipusername",aL);r.SaveParameter("displayname",aH);r.SaveParameter("email",aM);r.SaveParameter("voicemail",aJ);r.SaveParameter("callforwardonbusy",aN);r.ShowToast(h.get("reset_settings_msg2"))});x("#adialog_negative").on("click",function(aD){})}if(ax==="aec_orig"){var ab="";var ae="";var Z="";var ak="";var M="";var Y="";var R=al.split(",");for(var aB=0;aB<R.length;aB++){if(R[aB]==="-1"){ab='checked="checked"'}if(R[aB]==="0"){ae='checked="checked"'}if(R[aB]==="1"){Z='checked="checked"'}if(R[aB]==="2"){ak='checked="checked"'}if(R[aB]==="3"){M='checked="checked"'}if(R[aB]==="4"){Y='checked="checked"'}}var Q='<div id="settings_type_aec" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" data-dismissible="false" style="max-width:'+U+"px; min-width: "+Math.floor(U*0.6)+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content_select"><fieldset id="settings_select_3" data-role="controlgroup"><input name="'+ax+'" id="aec_auto" '+ab+' type="checkbox"><label for="aec_auto">'+h.get("aec_auto")+'</label><input name="'+ax+'" id="aec_none" '+ae+' type="checkbox"><label for="aec_none">'+h.get("aec_none")+'</label><input name="'+ax+'" id="aec_software" '+Z+' type="checkbox"><label for="aec_software">'+h.get("aec_software")+'</label><input name="'+ax+'" id="aec_native" '+ak+' type="checkbox"><label for="aec_native">'+h.get("aec_native")+'</label><input name="'+ax+'" id="aec_fast" '+M+' type="checkbox"><label for="aec_fast">'+h.get("aec_fast")+'</label><input name="'+ax+'" id="aec_decrease_volume" '+Y+' type="checkbox"><label for="aec_decrease_volume">'+h.get("aec_decrease_volume")+'</label></fieldset></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" style="width: 98%;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+h.get("btn_ok")+"</a></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();x("#adialog_positive").off("click");af()}});var P=0;x("#settings_type_aec").keypress(function(aD){P++;if(aD.which===13&&P<2){aD.preventDefault();x("#adialog_positive").click()}else{return}});x(":checkbox").on("change",function(aD){var aE=x(this).attr("id");if(aE==="aec_auto"){if(x("#"+aE).prop("checked")){x("#aec_none").prop("checked",false).checkboxradio("refresh");x("#aec_software").prop("checked",false).checkboxradio("refresh");x("#aec_native").prop("checked",false).checkboxradio("refresh");x("#aec_fast").prop("checked",false).checkboxradio("refresh");x("#aec_decrease_volume").prop("checked",false).checkboxradio("refresh")}}if(aE==="aec_none"){if(x("#"+aE).prop("checked")){x("#aec_auto").prop("checked",false).checkboxradio("refresh");x("#aec_software").prop("checked",false).checkboxradio("refresh");x("#aec_native").prop("checked",false).checkboxradio("refresh");x("#aec_fast").prop("checked",false).checkboxradio("refresh");x("#aec_decrease_volume").prop("checked",false).checkboxradio("refresh")}else{x("#aec_auto").prop("checked",true).checkboxradio("refresh")}}if(aE==="aec_software"){if(x("#"+aE).prop("checked")){x("#aec_auto").prop("checked",false).checkboxradio("refresh");x("#aec_none").prop("checked",false).checkboxradio("refresh")}else{if(x("#aec_native").prop("checked")===false&&x("#aec_fast").prop("checked")===false&&x("#aec_decrease_volume").prop("checked")===false){x("#aec_auto").prop("checked",true).checkboxradio("refresh")}}}if(aE==="aec_native"){if(x("#"+aE).prop("checked")){x("#aec_auto").prop("checked",false).checkboxradio("refresh");x("#aec_none").prop("checked",false).checkboxradio("refresh")}else{if(x("#aec_software").prop("checked")===false&&x("#aec_fast").prop("checked")===false&&x("#aec_decrease_volume").prop("checked")===false){x("#aec_auto").prop("checked",true).checkboxradio("refresh")}}}if(aE==="aec_fast"){if(x("#"+aE).prop("checked")){x("#aec_auto").prop("checked",false).checkboxradio("refresh");x("#aec_none").prop("checked",false).checkboxradio("refresh")}else{if(x("#aec_software").prop("checked")===false&&x("#aec_native").prop("checked")===false&&x("#aec_decrease_volume").prop("checked")===false){x("#aec_auto").prop("checked",true).checkboxradio("refresh")}}}if(aE==="aec_decrease_volume"){if(x("#"+aE).prop("checked")){x("#aec_auto").prop("checked",false).checkboxradio("refresh");x("#aec_none").prop("checked",false).checkboxradio("refresh")}else{if(x("#aec_software").prop("checked")===false&&x("#aec_native").prop("checked")===false&&x("#aec_fast").prop("checked")===false){x("#aec_auto").prop("checked",true).checkboxradio("refresh")}}}});x("#adialog_positive").on("click",function(aD){r.PutToDebugLog(5,"EVENT, settings onListItemClick aec_orig ok");al="";if(x("#aec_auto").prop("checked")){al+="-1,"}if(x("#aec_none").prop("checked")){al+="0,"}if(x("#aec_software").prop("checked")){al+="1,"}if(x("#aec_native").prop("checked")){al+="2,"}if(x("#aec_fast").prop("checked")){al+="3,"}if(x("#aec_decrease_volume").prop("checked")){al+="4,"}av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax)})}if(ax==="serveraddress_user"){var Q='<div id="settings_type_server" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+U+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+ad+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+X+'</span><div style="clear: both;"><!--//--></div><input type="text" id="setting_item_input" name="setting_item" data-theme="a"/><button id="btn_srvhelp" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="images/icon_help_mark.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+h.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+h.get("btn_cancel")+"</a></div></div>";var af=function(){};x.mobile.activePage.append(Q).trigger("create");x.mobile.activePage.find(".closePopup").bind("tap",function(aD){x.mobile.activePage.find(".messagePopup").popup("close")});x.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){x(this).unbind("popupafterclose").remove();x("#adialog_positive").off("click");x("#adialog_negative").off("click");x("#btn_srvhelp").off("click");af()}});var P=0;x("#settings_type_server").keypress(function(aD){P++;if(aD.which===13&&P<2){aD.preventDefault();x("#adialog_positive").click()}else{return}});if(wphone.treatuserserverinputasupperserver==="true"){al=r.GetParameter("upperserver")}var N=document.getElementById("setting_item_input");if(!r.isNull(al)&&al.length>0&&!r.isNull(N)){N.value=al}if(!r.isNull(N)){N.focus()}x("#adialog_positive").on("click",function(aE){r.PutToDebugLog(5,"EVENT, settings onListItemClick serveraddress ok");var aD="";if(!r.isNull(N)){aD=N.value}if(!r.isNull(aD)&&aD.length>0){al=r.Trim(aD);if(wphone.treatuserserverinputasupperserver==="true"){r.SaveParameter("upperserver",al);i(ax);return}if(b.autoprovisioning){if(b.autoServerDeployVersion&&al.indexOf(".")>0){r.AlertWindow(h.get("warning"),h.get("warning_msg_2"));return}al=al.toLowerCase();if(al.indexOf(".")>0||al.toLowerCase()==="mizu"){r.SaveParameter("serveraddress_orig",al)}}else{r.SaveParameter("serveraddress_orig",al)}av[r.SETT_VALUE]=al;av[r.SETT_ISDEFAULT]="0";r.settmap[ax]=av;i(ax)}});x("#adialog_negative").on("click",function(aD){});x("#btn_srvhelp").on("click",function(aE){x.mobile.activePage.find(".messagePopup").popup("close");var aD='<br /><a href="http://www.mizu-voip.com/VoIPServiceProviders.aspx" id="btn_srvhelp" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b " target="_blank">'+h.get("help_provider")+"</a>";r.AlertDialog(h.get("help"),h.get("srvaddr_help")+aD)})}}}catch(aC){r.PutToDebugLogException(2,"_settings: OnListItemClick",aC)}}function i(N){try{if(r.isNull(N)||N.length<1){r.PutToDebugLog(2,"_settings: ShowSettValue settname is NULL");return}var P=r.settmap[N];if(r.isNull(P)){return}var Q=P[r.SETT_ISDEFAULT];if(N==="serveraddress_user"&&wphone.treatuserserverinputasupperserver==="true"){document.getElementById("sett_comment_"+N).innerHTML=l(N)+" "+c(N);return}if(Q==="1"){return}var M=document.getElementById("sett_comment_"+N);if(r.isNull(M)){r.PutToDebugLog(2,"_settings: ShowSettValue commentfield is NULL");return}M.innerHTML=l(N)+" "+c(N)}catch(O){r.PutToDebugLogException(2,"_settings: ShowSettValue",O)}}function l(M){var R="";try{if(r.isNull(M)||M.length<1){r.PutToDebugLog(2,"_settings: GetSettComment settname is NULL");return""}var P=r.settmap[M];if(r.isNull(P)){return""}var Q=h.get("sett_comment_"+M);var O=h.get("sett_comment_short_"+M);if(!r.isNull(O)&&O.length>0){R=O}else{R=Q}}catch(N){r.PutToDebugLogException(2,"_settings: GetSettComment",N)}return R}function c(U){var S="";try{if(r.isNull(U)||U.length<1){r.PutToDebugLog(2,"_settings: GetSettComment settname is NULL");return""}var V=r.settmap[U];if(r.isNull(V)){return""}var T=V[r.SETT_TYPE];var M=V[r.SETT_VALUE];if(U==="password"&&M.length>0){S="*****"}else{if(T==="0"){if(M==="true"){S=h.get("sett_enabled")}else{S=h.get("sett_disabled")}}else{if(T==="1"){S=M;if((U==="ringtimeout"||U==="calltimeout")){S=S.substring(0,S.length-3)}}else{if(T==="2"){var W=(V[r.SETT_ALLNAMES]).split(",");var N=(V[r.SETT_ALLVALUES]).split(",");if(r.isNull(W)||W.length<1||r.isNull(N)||N.length<1){return""}for(var R=0;R<N.length;R++){if(N[R]===M){S=W[R];break}}}else{if(T==="3"){var W=(V[r.SETT_ALLNAMES]).split(",");var N=(V[r.SETT_ALLVALUES]).split(",");var O=[];if(M.indexOf(",")>0){O=M.split(",")}else{O[0]=M}if(r.isNull(W)||W.length<1||r.isNull(N)||N.length<1||r.isNull(O)){return""}for(var Q=0;Q<O.length;Q++){for(var R=0;R<N.length;R++){if(N[R]===O[Q]){if(S.length>0){S=S+", "}S=S+W[R]}}}}else{if(T==="4"){S=M+"%"}else{if(T==="5"||T==="6"||T==="7"){S=""}else{if(T==="8"){if(U==="aec_orig"){var W=(V[r.SETT_ALLNAMES]).split(",");var N=(V[r.SETT_ALLVALUES]).split(",");var O=[];if(M.indexOf(",")>0){O=M.split(",")}else{O[0]=M}if(r.isNull(W)||W.length<1||r.isNull(N)||N.length<1||r.isNull(O)){return""}for(var Q=0;Q<O.length;Q++){for(var R=0;R<N.length;R++){if(N[R]===O[Q]){if(S.length>0){S=S+", "}S=S+W[R]}}}}else{if(U==="serveraddress_user"){if(wphone.treatuserserverinputasupperserver==="true"){S=r.GetParameter("upperserver")}else{S=M}}}}}}}}}}}if(!r.isNull(S)&&S.length>0){S="("+S+")"}else{S=""}}catch(P){r.PutToDebugLogException(2,"_settings: GetSettFormattedValue",P)}return S}function J(N){try{if(w===r.StrToInt(r.GROUP_SIP)||w===r.StrToInt(r.GROUP_MEDIA)||w===r.StrToInt(r.GROUP_CALLDIVERT)||w===r.StrToInt(r.GROUP_GENERAL)){w=r.StrToInt(r.GROUP_MAIN);I();x("#btn_back_settings").hide();x("#app_name_settings").show();x("#settings_page_title").html(h.get("settings_title"))}else{if(w===r.StrToInt(r.GROUP_INTEGRATE)){w=r.StrToInt(r.GROUP_GENERAL);I();x("#settings_page_title").html(h.get("sett_display_name_submenu_general"));x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(w===r.StrToInt(r.GROUP_VIDEO)){w=r.StrToInt(r.GROUP_MEDIA);I();x("#settings_page_title").html(h.get("sett_display_name_submenu_media"));x("#btn_back_settings").html("<span>&LT;</span>&nbsp;"+h.get("settings_title"))}else{if(w===6){w=r.StrToInt(r.GROUP_MAIN);I();x("#settings_page_title").html(h.get("settings_title"))}}}}}catch(M){r.PutToDebugLogException(2,"_settings: BackOnClick",M)}}function a(){try{var M="";var S="";var R="";if(wphone.treatuserserverinputasupperserver==="true"){M=r.GetParameter("upperserver");S=h.get("sett_display_name_serveraddress_user");R=h.get("sett_comment_serveraddress_user");if(r.isNull(M)||M.length<=0){r.AlertDialog(S,h.get("please_enter")+" "+R);return}M=r.GetParameter("sipusername");S=h.get("sett_display_name_sipusername");R=h.get("sett_comment_sipusername");if(r.isNull(M)||M.length<=0){r.AlertDialog(S,h.get("please_enter")+" "+R);return}M=r.GetParameter("password");S=h.get("sett_display_name_password");R=h.get("sett_comment_password");if(r.isNull(M)||M.length<=0){r.AlertDialog(S,h.get("please_enter")+" "+R);return}}else{if(!b.customizedversion){M=r.GetParameter("sipusername");S=h.get("sett_display_name_sipusername");R=h.get("sett_comment_sipusername");if(r.isNull(M)||M.length<=0){r.AlertDialog(S,h.get("please_enter")+" "+R);return}M=r.GetParameter("serveraddress_user");S=h.get("sett_display_name_serveraddress_user");R=h.get("sett_comment_serveraddress_user");if(M.toLowerCase()==="mizu"){M="voip.mizu-voip.com";r.SaveParameter("serveraddress_user",M)}}else{M=r.GetParameter("sipusername");S=h.get("sett_display_name_sipusername");R=h.get("sett_comment_sipusername");if(r.isNull(M)||M.length<=0){r.AlertDialog(S,h.get("please_enter")+" "+R);return}M=r.GetParameter("password");S=h.get("sett_display_name_password");R=h.get("sett_comment_password");if(r.isNull(M)||M.length<=0){r.AlertDialog(S,h.get("please_enter")+" "+R);return}}}setTimeout(function(){if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){var T=b.WIN_SOFTPHONE_URL+"?extcmd_startwithos="+r.GetParameter("startwithos");r.WinSoftphoneHttpReq(T,"GET","",function(U){PutToDebugLog(2,"EVENT, _settings: startwithos response: "+U)})}},5000);x("#settings_page_title").html(h.get("loading"));if(t===false){var O=[];var P="Account"+r.GetParameter("sipusername");var N=r.Md5Hash(P+r.GetParameter("serveraddress_user")+r.GetParameter("sipusername")+b.SALT+r.GetParameter("password"));O[r.AC_NAME]=P;O[r.AC_SIPUSERNAME]=r.GetParameter("sipusername");O[r.AC_SETTFILE]=N;O[r.AC_CHFILE]=N+"_ch";O[r.AC_ISACTIVE]="true";b.aclist.push(O)}r.SaveSettingsFile(r.GetActiveAccSettingsFilename(),function(T){x.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"});if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){setTimeout(function(){webphone_public.webphone_started=false;webphone_public.StartWin()},100)}else{setTimeout(function(){wphone.start(r.GetParameter("sipusername"),r.GetParameter("password"))},500)}r.SaveAccountsFile(function(U){if(U){r.PutToDebugLog(3,"EVENT, _settings: SaveSettings Accounts file saved successfully")}else{r.PutToDebugLog(2,"ERROR, _settings: SaveSettings Accounts file save failed")}})})}catch(Q){r.PutToDebugLogException(2,"_settings: SaveSettings",Q)}}function k(){try{var M=h.get("newuser_uri");if(M.indexOf("[")>0&&M.indexOf("]")>0){x.mobile.changePage("#page_newuser",{transition:"pop",role:"page"})}else{r.OpenWebURL(h.get("newuser_uri"),h.get("newuser"))}}catch(N){r.PutToDebugLogException(2,"_settings: OnNewUserClicked",N)}}var s="#menuitem_settings_level";var o="#menuitem_settings_search";var j="#menuitem_settings_help";var H="#menuitem_settings_exit";function n(P){try{if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){x("#btn_settings_menu").removeAttr("data-transition")}if(r.isNull(P)||P.lenght<1){r.PutToDebugLog(2,"ERROR, _settings: CreateOptionsMenu menuid null");return}if(x(P).length<=0){r.PutToDebugLog(2,"ERROR, _settings: CreateOptionsMenu can't get reference to Menu");return}if(P.charAt(0)!=="#"){P="#"+P}x(P).html("");var N="";if(K){N=h.get("menu_switchtoadvanced")}else{N=h.get("menu_switchtobasic")}var O="";if(D){O=h.get("hide_search")}else{O=h.get("show_search")}x(P).append('<li id="'+s+'"><a data-rel="back">'+N+"</a></li>").listview("refresh");x(P).append('<li id="'+o+'"><a data-rel="back">'+O+"</a></li>").listview("refresh");x(P).append('<li id="'+j+'"><a data-rel="back">'+h.get("menu_help")+"</a></li>").listview("refresh");if(r.GetParameter("devicetype")===r.DEVICE_WIN_SOFTPHONE()){x(P).append('<li id="'+H+'"><a data-rel="back">'+h.get("menu_exit")+"</a></li>").listview("refresh")}return true}catch(M){r.PutToDebugLogException(2,"_settings: CreateOptionsMenu",M)}return false}function q(N){try{if(r.isNull(N)||N.length<1){return}x("#settings_menu").on("popupafterclose",function(O){x("#settings_menu").off("popupafterclose");switch(N){case s:u();break;case o:m();break;case j:r.HelpWindow("settings");break;case H:r.Exit();break}})}catch(M){r.PutToDebugLogException(2,"_settings: MenuItemSelected",M)}}function u(){try{if(K){K=false;I();r.SaveParameter("settlevelbasic","false")}else{K=true;if(w===r.StrToInt(r.GROUP_MEDIA)){w=r.StrToInt(r.GROUP_MAIN)}I();r.SaveParameter("settlevelbasic","true")}}catch(M){r.PutToDebugLogException(2,"_settings: SwitchBetweenBasicAdvanced",M)}}function m(){try{if(D){D=false;x("#settings_list").prev("form.ui-filterable").hide();I();d()}else{D=true;x("#settings_list").prev("form.ui-filterable").show();I();d()}}catch(M){r.PutToDebugLogException(2,"_settings: ShowHideSearch",M)}}function p(N){try{r.PutToDebugLog(4,"_settings: onStop");b.isSettingsStarted=false;L=""}catch(M){r.PutToDebugLogException(2,"_settings: onStop",M)}}function y(N){try{r.PutToDebugLog(4,"_settings: onDestroy");b.isSettingsStarted=false}catch(M){r.PutToDebugLogException(2,"_settings: onDestroy",M)}}return{onCreate:z,onStart:f,onStop:p,onDestroy:y}});