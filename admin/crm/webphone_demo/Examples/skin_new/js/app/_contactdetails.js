define(["jquery","common","stringres","global"],function(b,k,i,p){var j=-1;var s=null;function q(v){try{k.PutToDebugLog(4,"_contactdetails: onCreate");b(window).resize(function(){if(b.mobile.activePage.attr("id")==="page_contactdetails"){n()}});b("#contactdetails_menu_ul").on("click","li",function(w){a(b(this).attr("id"))});b("#btn_contactdetails_menu").on("click",function(){g("#contactdetails_menu_ul")});b("#btn_contactdetails_menu").attr("title",i.get("hint_menu"))}catch(u){k.PutToDebugLogException(2,"_contactdetails: onCreate",u)}}function t(v){try{k.PutToDebugLog(4,"_contactdetails: onStart");p.isContactdetailsStarted=true;b(".separator_line_thick").css("background-color",k.HoverCalc(k.getBgColor("#page_contactdetails"),-30));if(!k.isNull(document.getElementById("contactdetails_title"))){document.getElementById("contactdetails_title").innerHTML=i.get("ctdetails_title")}if(!k.isNull(document.getElementById("ctdetails_btnback"))){document.getElementById("ctdetails_btnback").innerHTML="<span>&LT;</span>&nbsp;"+i.get("ctdetails_btnback_txt")}n();try{j=k.StrToInt(k.GetIntentParam(p.intentctdetails,"ctid"))}catch(u){k.PutToDebugLogException(2,"_contactdetails: onStart can't convert ctid to INT",u)}s=p.ctlist[j];o()}catch(u){k.PutToDebugLogException(2,"_contactdetails: onStart",u)}}function n(){try{var u=k.GetDeviceHeight()-b("#contactdetails_header").height();u=u-3;b("#page_contactdetails_content").height(u)}catch(v){k.PutToDebugLogException(2,"_contactdetails: MeasureContactdetails",v)}}function o(){try{if(k.isNull(s)||s.length<1){k.PutToDebugLog(2,"ERROR, _contactdetails PopulateData contact is NULL");return}b("#page_contactdetails_content").html("");var z='<div id="contact_name"><p>'+s[k.CT_NAME]+"</p></div>";var u=s[k.CT_NUMBER];var w=s[k.CT_PTYPE];if(!k.isNull(u)&&u.length>0){for(var v=0;v<u.length;v++){var y='<div id="ct_entry_'+v+'" class="cd_container"><div id="cd_call_'+v+'" class="cd_call"><div class="cd_data"><div class="cd_type">'+i.get("type_"+w[v])+'</div><div class="cd_number">'+u[v]+'</div></div><div class="cd_icon"><img src="images/icon_call.png" /></div></div></div>';z=z+y}for(var v=0;v<u.length;v++){var y='<div id="ct_entry_'+v+'" class="cd_container"><div id="cd_msg_'+v+'" class="cd_call"><div class="cd_data"><div class="cd_type">'+i.get("send_msg")+'</div><div class="cd_number">'+u[v]+'</div></div><div class="cd_icon"><img src="images/icon_message.png" /></div></div></div>';z=z+y}}b("#page_contactdetails_content").html(z);if(!k.isNull(u)&&u.length>0){for(var v=0;v<u.length;v++){(function(A){b("#cd_call_"+A).on("click",function(){d(A,true)});b("#cd_msg_"+A).on("click",function(){d(A,false)})}(v))}}}catch(x){k.PutToDebugLogException(2,"_contactdetails: PopulateData",x)}}function d(x,y){try{if(k.isNull(x)||k.isNull(y)){return}var u=s[k.CT_NUMBER];var z=u[x];var v=s[k.CT_NAME];if(y){wphone.call(-1,z,v);b.mobile.back()}else{k.StartMsg(z,"","_contactdetails")}}catch(w){k.PutToDebugLogException(2,"_contactdetails: OnItemClick",w)}}var m="#menuitem_contactdetails_edit";var e="#menuitem_contactdetails_delete";function g(v){try{if(k.GetParameter("devicetype")===k.DEVICE_WIN_SOFTPHONE()){b("#btn_contactdetails_menu").removeAttr("data-transition")}if(k.isNull(v)||v.lenght<1){k.PutToDebugLog(2,"ERROR, _contactdetails: CreateOptionsMenu menuid null");return}if(b(v).length<=0){k.PutToDebugLog(2,"ERROR, _contactdetails: CreateOptionsMenu can't get reference to Menu");return}if(v.charAt(0)!=="#"){v="#"+v}b(v).html("");b(v).append('<li id="'+m+'"><a data-rel="back">'+i.get("menu_editcontact")+"</a></li>").listview("refresh");b(v).append('<li id="'+e+'"><a data-rel="back">'+i.get("menu_deletecontact")+"</a></li>").listview("refresh");return true}catch(u){k.PutToDebugLogException(2,"_contactdetails: CreateOptionsMenu",u)}return false}function a(v){try{if(k.isNull(v)||v.length<1){return}b("#contactdetails_menu").on("popupafterclose",function(w){b("#contactdetails_menu").off("popupafterclose");switch(v){case m:r();break;case e:h();break}})}catch(u){k.PutToDebugLogException(2,"_contactdetails: MenuItemSelected",u)}}function r(){try{p.intentaddeditct[0]="action=edit";p.intentaddeditct[1]="ctid="+j;b.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})}catch(u){k.PutToDebugLogException(2,"_contactdetails: EditContact",u)}}function h(u){try{var x=k.GetDeviceWidth();if(!k.isNull(x)&&k.IsNumber(x)&&x>100){x=Math.floor(x/1.2)}else{x=220}var v='<div id="delete_contact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+x+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+i.get("menu_deletecontact")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+i.get("contact_delete_msg")+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="btn_adialog_ok" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+i.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+i.get("btn_cancel")+"</a></div></div>";u=u?u:function(){};b.mobile.activePage.append(v).trigger("create");b.mobile.activePage.find(".closePopup").bind("tap",function(y){b.mobile.activePage.find(".messagePopup").popup("close")});b.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){b(this).unbind("popupbeforeposition");var y=Math.floor(k.GetDeviceHeight()*0.6);if(b(this).height()>y){b(".messagePopup .ui-content").height(y)}}});b.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){b(this).unbind("popupafterclose").remove();b("#btn_adialog_ok").off("click");u()}});b("#btn_adialog_ok").on("click",function(){l()})}catch(w){k.PutToDebugLogException(2,"_contactdetails: DeleteContactPopup",w)}}function l(){try{b("#delete_contact_popup").on("popupafterclose",function(v){b("#delete_contact_popup").off("popupafterclose");p.ctlist.splice(j,1);k.SaveContactsFile(function(w){k.PutToDebugLog(4,"EVENT, _contactdetails: DeleteContact SaveContactsFile: "+w.toString())});b.mobile.back()})}catch(u){k.PutToDebugLogException(2,"_contactdetails: DeleteContact",u)}}function f(v){try{k.PutToDebugLog(4,"_contactdetails: onStop");p.isContactdetailsStarted=false}catch(u){k.PutToDebugLogException(2,"_contactdetails: onStop",u)}}function c(v){try{k.PutToDebugLog(4,"_contactdetails: onDestroy");p.isContactdetailsStarted=false;b("#page_contactdetails_content").html("")}catch(u){k.PutToDebugLogException(2,"_contactdetails: onDestroy",u)}}return{onCreate:q,onStart:t,onStop:f,onDestroy:c}});