define(["jquery","common","stringres","global"],function(g,k,a,b){function f(q){try{k.PutToDebugLog(4,"_newuser: onCreate");g(window).resize(function(){if(g.mobile.activePage.attr("id")==="page_newuser"){j()}});g("#newuser_menu_ul").on("click","li",function(r){h(g(this).attr("id"))});g("#btn_newuser_menu").on("click",function(){o("#newuser_menu_ul")});g("#btn_newuser_menu").attr("title",a.get("hint_menu"));g("#btn_create_newuser").on("click",function(){m()});g("#btn_cancel_newuser").on("click",function(){g.mobile.back()})}catch(p){k.PutToDebugLogException(2,"_newuser: onCreate",p)}}function n(q){try{k.PutToDebugLog(4,"_newuser: onStart");b.isNewuserStarted=true;if(!k.isNull(document.getElementById("newuser_title"))){document.getElementById("newuser_title").innerHTML=a.get("newuser_title")}if(!k.isNull(document.getElementById("newuser_btnback"))){document.getElementById("newuser_btnback").innerHTML="<span>&LT;</span>&nbsp;"+a.get("go_back_btn_txt")}if(!k.isNull(document.getElementById("btn_create_newuser"))){document.getElementById("btn_create_newuser").innerHTML=a.get("btn_create")}if(!k.isNull(document.getElementById("btn_cancel_newuser"))){document.getElementById("btn_cancel_newuser").innerHTML=a.get("btn_cancel")}j();c()}catch(p){k.PutToDebugLogException(2,"_newuser: onStart",p)}}function j(){try{g(".separator_line_thick").css("background-color",k.HoverCalc(k.getBgColor("#page_newuser"),-30));var p=k.GetDeviceHeight()-g("#newuser_header").height()-g("#newuser_footer").height();p=p-3;p=Math.floor(p);g("#page_newuser_content").height(p)}catch(q){k.PutToDebugLogException(2,"_newuser: MeasureNewuser",q)}}function c(){try{var p=a.get("newuser_uri");g("#label_nu_username").html("*"+a.get("nu_username"));g("#label_nu_password").html("*"+a.get("nu_password"));g("#label_nu_email").html("*"+a.get("nu_email"));g("#label_nu_fullname").html("*"+a.get("nu_fullname"));g("#label_nu_phone").html("*"+a.get("nu_phone"));g("#label_nu_address").html("*"+a.get("nu_address"));if(!k.isNull(p)&&p.length>0){if(p.indexOf("[USERNAME]")>=0){document.getElementById("nu_username_container").style.display="block"}if(p.indexOf("[PASSWORD]")>=0){document.getElementById("nu_password_container").style.display="block"}if(p.indexOf("[MAIL]")>=0){document.getElementById("nu_email_container").style.display="block"}if(p.indexOf("[NAME]")>=0){document.getElementById("nu_fullname_container").style.display="block"}if(p.indexOf("[PHONE]")>=0){document.getElementById("nu_phone_container").style.display="block"}if(p.indexOf("[ADDRESS]")>=0){document.getElementById("nu_address_container").style.display="block"}}}catch(q){k.PutToDebugLogException(2,"_newuser: PopulateData",q)}}function m(){try{var w=document.getElementById("nu_username").value;var s=document.getElementById("nu_password").value;var r=document.getElementById("nu_email").value;var v=document.getElementById("nu_fullname").value;var q=document.getElementById("nu_phone").value;var p=document.getElementById("nu_address").value;if(k.isNull(w)){w=""}else{w=k.Trim(w)}if(k.isNull(s)){s=""}else{s=k.Trim(s)}if(k.isNull(r)){r=""}else{r=k.Trim(r)}if(k.isNull(v)){v=""}else{v=k.Trim(v)}if(k.isNull(q)){q=""}else{q=k.Trim(q)}if(k.isNull(p)){p=""}else{p=k.Trim(w)}if(document.getElementById("nu_username_container").style.display==="block"){if(k.isNull(w)||w.length<1){k.ShowToast(a.get("err_msg_8"));return}else{if(w.length<k.MIN_USR_PWD_LENGHT){k.ShowToast(a.get("err_msg_13")+" "+k.MIN_USR_PWD_LENGHT);return}else{if(k.isNull(w.match("^[A-Za-z0-9_-]{2,120}$"))||(w.match("^[A-Za-z0-9_-]{2,120}$")[0]).length<1){k.ShowToast(a.get("err_msg_14"));return}}}}if(document.getElementById("nu_password_container").style.display==="block"){if(k.isNull(s)||s.length<1){k.ShowToast(a.get("err_msg_9"));return}else{if(s.length<k.MIN_USR_PWD_LENGHT){k.ShowToast(a.get("err_msg_15")+" "+k.MIN_USR_PWD_LENGHT);return}else{if(k.isNull(s.match("^[A-Za-z0-9_-]{2,120}$"))||(s.match("^[A-Za-z0-9_-]{2,120}$")[0]).length<1){k.ShowToast(a.get("err_msg_16"));return}}}}if(document.getElementById("nu_email_container").style.display==="block"){if(k.isNull(r)||r.length<1){k.ShowToast(a.get("err_msg_10"));return}else{if(k.isNull(r.match("^[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9|-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$"))||(r.match("^[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9|-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$")[0]).length<1){k.ShowToast(a.get("err_msg_12"));return}}}var t=a.get("newuser_uri");t=t.replace("[USERNAME]",w);t=t.replace("[PASSWORD]",s);t=t.replace("[MAIL]",r);if(document.getElementById("nu_fullname_container").style.display==="block"){if(k.isNull(v)||v.length<1){k.ShowToast(a.get("err_msg_11"));return}else{if(v.length<k.MIN_USR_PWD_LENGHT){k.ShowToast(a.get("err_msg_17")+" "+k.MIN_USR_PWD_LENGHT);return}else{if(k.isNull(v.match("^[A-Za-z0-9_ -]{2,150}$"))||(v.match("^[A-Za-z0-9_ -]{2,150}$")[0]).length<1){k.ShowToast(a.get("err_msg_18"));return}}}v=encodeURIComponent(v);t=t.replace("[NAME]",v)}if(document.getElementById("nu_phone_container").style.display==="block"){if(k.isNull(q)||q.length<1){k.ShowToast(a.get("err_msg_21"));return}else{if(q.length<5){k.ShowToast(a.get("err_msg_19"));return}else{if(k.isNull(q.match("^[0-9+]{3,25}$"))||(v.match("^[0-9+]{3,25}$")[0]).length<1){k.ShowToast(a.get("err_msg_19"));return}}}q=k.ReplaceAll(q," ","");t=t.replace("[PHONE]",q)}if(document.getElementById("nu_address_container").style.display==="block"){if(k.isNull(p)||p.length<10){k.ShowToast(a.get("err_msg_20"));return}p=encodeURIComponent(p);t=t.replace("[ADDRESS]",p)}if(!k.isNull(r)&&r.length>0){k.SaveParameter("email",r)}if(!k.isNull(v)&&v.length>0){k.SaveParameter("displayname",v)}if(!k.isNull(w)&&w.length>0){k.SaveParameter("sipusername",w)}if(!k.isNull(s)&&s.length>0){k.SaveParameter("password",s)}k.UriParser(t,"","","","","newuserreg");k.PutToDebugLog(4,"EVENT, _newuser CreateUser uri: "+t)}catch(u){k.PutToDebugLogException(2,"_newuser: CreateUser",u)}}var e="#menuitem_newuser_close";function o(q){try{if(k.GetParameter("devicetype")===k.DEVICE_WIN_SOFTPHONE()){g("#btn_newuser_menu").removeAttr("data-transition")}if(k.isNull(q)||q.lenght<1){k.PutToDebugLog(2,"ERROR, _newuser: CreateOptionsMenu menuid null");return}if(g(q).length<=0){k.PutToDebugLog(2,"ERROR, _newuser: CreateOptionsMenu can't get reference to Menu");return}if(q.charAt(0)!=="#"){q="#"+q}g(q).html("");g(q).append('<li id="'+e+'"><a data-rel="back">'+a.get("menu_close")+"</a></li>").listview("refresh");return true}catch(p){k.PutToDebugLogException(2,"_newuser: CreateOptionsMenu",p)}return false}function h(q){try{if(k.isNull(q)||q.length<1){return}g("#newuser_menu").on("popupafterclose",function(r){g("#newuser_menu").off("popupafterclose");switch(q){case e:d();break}})}catch(p){k.PutToDebugLogException(2,"_newuser: MenuItemSelected",p)}}function d(){try{if(lastpage.length<2){g.mobile.back()}else{g.mobile.changePage("#"+lastpage,{transition:"pop",role:"page"})}}catch(p){k.PutToDebugLogException(2,"_newuser: CloseBrowser",p)}}function i(q){try{k.PutToDebugLog(4,"_newuser: onStop");b.isNewuserStarted=false}catch(p){k.PutToDebugLogException(2,"_newuser: onStop",p)}}function l(q){try{k.PutToDebugLog(4,"_newuser: onDestroy");b.isNewuserStarted=false}catch(p){k.PutToDebugLogException(2,"_newuser: onDestroy",p)}}return{onCreate:f,onStart:n,onStop:i,onDestroy:l}});