define(["jquery","common","stringres","global"],function(c,o,l,s){window.onbeforeunload=(function(B){try{o.PutToDebugLog(3,"EVENT, _dialpad: Window.OnUnload close or refresh event detected");if(s.wasSettModified){o.SaveSettingsFile(o.GetActiveAccSettingsFilename(),function(D){if(D){o.PutToDebugLog(2,"EVENT, SaveSettingsFile on exit Successfull")}else{o.PutToDebugLog(2,"ERROR, SaveSettingsFile on exit Failed")}})}if(s.wasCtModified){o.SaveContactsFile(function(D){if(D){o.PutToDebugLog(2,"EVENT, SaveContactsFile on exit Successfull")}else{o.PutToDebugLog(2,"ERROR, SaveContactsFile on exit Failed")}})}if(s.wasChModified){o.SaveCallhistoryFile(function(D){if(D){o.PutToDebugLog(2,"EVENT, SaveCallhistoryFile on exit Successfull")}else{o.PutToDebugLog(2,"ERROR, SaveCallhistoryFile on exit Failed")}})}}catch(C){o.PutToDebugLogException(2,"_dialpad: Window.OnUnload",C)}});function t(C){try{o.PutToDebugLog(4,"_dialpad: onCreate");c("#nav_dp_contacts").on("click",function(){c.mobile.changePage("#page_contactslist",{transition:"none",role:"page"})});c("#nav_dp_callhistory").on("click",function(){c.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"})});c("#nav_dp_dialpad").attr("title",l.get("hint_dialpad"));c("#nav_dp_contacts").attr("title",l.get("hint_contacts"));c("#nav_dp_callhistory").attr("title",l.get("hint_callhistory"));c("#status_dialpad").attr("title",l.get("hint_status"));c("#curr_user_dialpad").attr("title",l.get("hint_curr_user"));c("#phone_number").attr("title",l.get("hint_phone_number"));c("#phone_number").attr("title",l.get("hint_phone_number"));c("#btn_voicemail").on("click",function(){try{var E=o.GetParameter("voicemail");if(!o.isNull(E)&&E.length>0){v(E)}else{q()}}catch(D){o.PutToDebugLogException(2,"_dialpad: btn_voicemail on click",D)}});c("#btn_voicemail").attr("title",l.get("hint_voicemail"));c("#btn_call").on("click",function(){if(wphone.treatuserserverinputasupperserver==="true"){if((o.isNull(o.GetParameter("sipusername"))||o.GetParameter("sipusername").length<=0||o.isNull(o.GetParameter("password"))||o.GetParameter("password").length<=0||o.isNull(o.GetParameter("upperserver"))||o.GetParameter("upperserver").length<=0)){return}}var F=document.getElementById("phone_number");if(o.isNull(F)){return}var D=F.value;var E=o.GetParameter("redial");if(o.isNull(D)||D.length<1){if(!o.isNull(E)&&E.length>0){F.value=E}else{o.PutToDebugLog(1,l.get("err_msg_3"));return}}else{D=o.Trim(D);v(D);o.SaveParameter("redial",D)}});c("#btn_call").attr("title",l.get("hint_btn_call"));c("#page_dialpad").keypress(function(D){if(D.which===13){D.preventDefault();c("#btn_call").click()}else{return}});c("#btn_message").on("click",function(){r()});c("#btn_message").attr("title",l.get("hint_message"));c("#dialpad_notification").on("click",function(){o.NotificationOnClick()});c(window).resize(function(){if(c.mobile.activePage.attr("id")==="page_dialpad"){A()}});c("#dialpad_menu_ul").on("click","li",function(D){a(c(this).attr("id"))});c("#btn_dialpad_menu").on("click",function(){j("#dialpad_menu_ul")});c("#btn_dialpad_menu").attr("title",l.get("hint_menu"));setTimeout(function(){if(!s.customizedversion){var D=false;if(wphone.treatuserserverinputasupperserver==="true"){if((o.isNull(o.GetParameter("sipusername"))||o.GetParameter("sipusername").length<=0||o.isNull(o.GetParameter("password"))||o.GetParameter("password").length<=0||o.isNull(o.GetParameter("upperserver"))||o.GetParameter("upperserver").length<=0)){D=true}}else{if((o.isNull(o.GetParameter("sipusername"))||o.GetParameter("sipusername").length<=0||o.isNull(o.GetParameter("password"))||o.GetParameter("password").length<=0||o.isNull(o.GetParameter("serveraddress_user"))||o.GetParameter("serveraddress_user").length<=0)){D=true}}}if(D){o.AlertDialog(l.get("warning"),l.get("warning_msg_1"))}},200);c("#btn_dp_1").on("click",function(){k("1")});c("#btn_dp_2").on("click",function(){k("2")});c("#btn_dp_3").on("click",function(){k("3")});c("#btn_dp_4").on("click",function(){k("4")});c("#btn_dp_5").on("click",function(){k("5")});c("#btn_dp_6").on("click",function(){k("6")});c("#btn_dp_7").on("click",function(){k("7")});c("#btn_dp_8").on("click",function(){k("8")});c("#btn_dp_9").on("click",function(){k("9")});c("#btn_dp_0").on("click",function(){k("0")});c("#btn_dp_ast").on("click",function(){k("*")});c("#btn_dp_diez").on("click",function(){k("#")});c("#btn_backspace").on("click",function(){var D=document.getElementById("phone_number");if(o.isNull(D)||o.isNull(D.value)||D.value.length<1){return}D.value=(D.value).substring(0,D.value.length-1)});setTimeout(function(){o.GetContacts(function(D){if(!D){o.PutToDebugLog(2,"ERROR, _dialpad: LoadContacts failed")}})},500);setTimeout(function(){o.ReadCallhistoryFile(function(D){if(!D){o.PutToDebugLog(2,"ERROR, _dialpad: load call history failed")}})},1000)}catch(B){o.PutToDebugLogException(2,"_dialpad: onCreate",B)}}function k(C){try{var D=document.getElementById("phone_number");if(o.isNull(D)){return}if(o.isNull(D.value)){D.value=""}D.value=D.value+C;g(C)}catch(B){o.PutToDebugLogException(2,"_dialpad: PutNumber",B)}}var m=null;function g(C){try{if(!window.HTMLAudioElement){o.PutToDebugLog(2,"WARNING, PlayDtmfSound audio html element not supported in this browser: "+o.GetBrowser());return}if(o.isNull(C)){return}if(C==="*"){C="x"}else{if(C==="#"){C="y"}}if(o.isNull(m)){m=document.getElementById("dtmfsound"+C);if(o.isNull(m)){o.PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element");return}m.play()}else{m.pause();m.currentTime=0;m=document.getElementById("dtmfsound"+C);if(o.isNull(m)){o.PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element");return}m.currentTime=0;m.play()}}catch(B){o.PutToDebugLogException(2,"_dialpad: PlayDtmfSound",B)}}function v(C){try{if(o.isNull(C)||C.length<1){o.PutToDebugLog(2,"_dialpad: StartCall number is NULL");return}C=o.StripSpecialChar(C);wphone.call(-1,C,"")}catch(B){o.PutToDebugLogException(2,"_dialpad: StartCall",B)}}function q(){try{var E=o.GetDeviceWidth();if(!o.isNull(E)&&o.IsNumber(E)&&E>100){E=Math.floor(E/1.2)}else{E=220}var C='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+E+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+l.get("voicemail_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+l.get("voicemail_msg")+'</span><input type="text" id="voicemail_input" name="setting_item" data-theme="a"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+l.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+l.get("btn_cancel")+"</a></div></div>";var B=function(){};c.mobile.activePage.append(C).trigger("create");c.mobile.activePage.find(".closePopup").bind("tap",function(G){c.mobile.activePage.find(".messagePopup").popup("close")});c.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){c(this).unbind("popupafterclose").remove();c("#adialog_positive").off("click");c("#adialog_negative").off("click");B()}});var F=document.getElementById("voicemail_input");if(!o.isNull(F)){F.focus()}c("#adialog_positive").on("click",function(G){o.PutToDebugLog(5,"EVENT, _dialpad SetVoceMailNumber OK click");var H="";if(!o.isNull(F)){H=F.value}if(!o.isNull(H)&&H.length>0){H=o.Trim(H);o.SaveParameter("voicemail",H)}});c("#adialog_negative").on("click",function(G){})}catch(D){o.PutToDebugLogException(2,"_dialpad: SetVoceMailNumber",D)}}function w(C){try{o.PutToDebugLog(4,"_dialpad: onStart");s.isDialpadStarted=true;c("#phone_number").attr("placeholder",l.get("phone_nr"));if(!o.isNull(document.getElementById("app_name_dialpad"))&&o.GetParameter("devicetype")!==o.DEVICE_WIN_SOFTPHONE()){document.getElementById("app_name_dialpad").innerHTML=l.get("app_name")}if(!o.isNull(document.getElementById("dialpad_title"))){document.getElementById("dialpad_title").innerHTML=l.get("dialpad_title")}var D=o.GetParameter("sipusername");if(!o.isNull(D)&&D.length>0){c("#curr_user_dialpad").html(D)}o.ShowNotifications();A()}catch(B){o.PutToDebugLogException(2,"_dialpad: onStart",B)}}function A(){try{c(".separator_line_thick").css("background-color",o.HoverCalc(o.getBgColor("#page_dialpad"),-30));var G=o.GetDeviceWidth()-c("#dialpad_additional_header_left").width()-c("#dialpad_additional_header_right").width();var F=o.StrToIntPx(c("#dialpad_additional_header_left").css("margin-left"));if(o.isNull(F)||F===0){F=10}F=Math.ceil(F*6);G=Math.floor(G-F)-20;c("#dialpad_notification").height(Math.floor(c("#dialpad_additional_header_left").height()));var E=o.GetDeviceHeight()-c("#dialpad_header").height()-o.StrToIntPx(c("#dialpad_header").css("border-top-width"))-o.StrToIntPx(c("#dialpad_header").css("border-bottom-width"))-2*(c(".separator_color_bg").height());var D=Math.floor(E/6);c("#phone_number_container").height(D);c("#phone_number_container").css("line-height",D+"px");c("#dialpad_btn_grid .ui-btn").height(D);var B=E-c("#phone_number_container").height()-c("#dialpad_btn_grid").height()-3;c("#dialpad_call_grid .ui-btn").height(B);c("#dialpad_call_grid .ui-btn").css("line-height",B+"px")}catch(C){o.PutToDebugLogException(2,"_dialpad: MeasureDialPad",C)}}function r(){try{var B=o.Trim(document.getElementById("phone_number").value);if(o.isNull(B)||B.length<1){o.StartMsg("","","_dialpad")}else{o.StartMsg(B,"","_dialpad")}}catch(C){o.PutToDebugLogException(2,"_dialpad: MsgOnClick",C)}}var h="#menuitem_dialpad_provider";var n="#menuitem_dialpad_myaccount";var y="#menuitem_dialpad_p2p";var b="#menuitem_dialpad_callback";var p="#menuitem_dialpad_recharge";var f="#menuitem_dialpad_settings";var x="#menuitem_dialpad_help";var u="#menuitem_dialpad_exit";function j(C){try{if(o.GetParameter("devicetype")===o.DEVICE_WIN_SOFTPHONE()){c("#btn_dialpad_menu").removeAttr("data-transition")}if(o.isNull(C)||C.lenght<1){o.PutToDebugLog(2,"ERROR, _dialpad: CreateOptionsMenu menuid null");return}if(c(C).length<=0){o.PutToDebugLog(2,"ERROR, _dialpad: CreateOptionsMenu can't get reference to Menu");return}if(C.charAt(0)!=="#"){C="#"+C}c(C).html("");c(C).append('<li id="'+f+'"><a data-rel="back">'+l.get("settings_title")+"</a></li>").listview("refresh");if(!o.isNull(l.get("provider_uri"))&&l.get("provider_uri").length>3){c(C).append('<li id="'+h+'"><a data-rel="back">'+l.get("myprovider")+"</a></li>").listview("refresh")}if(!o.isNull(l.get("account_uri"))&&l.get("account_uri").length>3){c(C).append('<li id="'+n+'"><a data-rel="back">'+l.get("myaccount")+"</a></li>").listview("refresh")}if(!o.isNull(l.get("p2p_uri"))&&l.get("p2p_uri").length>3){c(C).append('<li id="'+y+'"><a data-rel="back">'+l.get("p2p")+"</a></li>").listview("refresh")}if(!o.isNull(l.get("callback_uri"))&&l.get("callback_uri").length>3){c(C).append('<li id="'+b+'"><a data-rel="back">'+l.get("callback")+"</a></li>").listview("refresh")}if(!o.isNull(l.get("recharge_uri"))&&l.get("recharge_uri").length>3){c(C).append('<li id="'+p+'"><a data-rel="back">'+l.get("recharge")+"</a></li>").listview("refresh")}c(C).append('<li id="'+x+'"><a data-rel="back">'+l.get("menu_help")+"</a></li>").listview("refresh");if(o.GetParameter("devicetype")===o.DEVICE_WIN_SOFTPHONE()){c(C).append('<li id="'+u+'"><a data-rel="back">'+l.get("menu_exit")+"</a></li>").listview("refresh")}return true}catch(B){o.PutToDebugLogException(2,"_dialpad: CreateOptionsMenu",B)}return false}function a(C){try{if(o.isNull(C)||C.length<1){return}c("#dialpad_menu").on("popupafterclose",function(D){c("#dialpad_menu").off("popupafterclose");switch(C){case f:o.OpenSettings();break;case h:o.OpenWebURL(l.get("provider_uri"),l.get("myprovider"));break;case n:o.OpenWebURL(l.get("account_uri"),l.get("myaccount"));break;case y:z();break;case b:e();break;case p:o.OpenWebURL(l.get("recharge_uri"),l.get("recharge"));break;case x:o.HelpWindow("dialpad");break;case u:o.Exit();break}})}catch(B){o.PutToDebugLogException(2,"_dialpad: MenuItemSelected",B)}}function z(){try{var F=o.GetDeviceWidth();if(!o.isNull(F)&&o.IsNumber(F)&&F>100){F=Math.floor(F/1.2)}else{F=220}var C='<div id="adialog_p2p" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+F+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+l.get("p2p")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+l.get("p2p_nra")+'</span><input type="text" id="phonea_input" name="phonea_input" data-theme="a"/><span>'+l.get("p2p_nrb")+'</span><input type="text" id="phoneb_input" name="phoneb_input" data-theme="a"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+l.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+l.get("btn_cancel")+"</a></div></div>";var B=function(){};c.mobile.activePage.append(C).trigger("create");c.mobile.activePage.find(".closePopup").bind("tap",function(I){c.mobile.activePage.find(".messagePopup").popup("close")});c.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){c(this).unbind("popupafterclose").remove();c("#adialog_positive").off("click");c("#adialog_negative").off("click");B()}});var H=0;c("#adialog_p2p").keypress(function(I){H++;if(I.which===13&&H<2){I.preventDefault();c("#adialog_positive").click()}else{return}});var G=document.getElementById("phonea_input");var E=document.getElementById("phoneb_input");if(!o.isNull(G)){G.focus()}c("#adialog_positive").on("click",function(K){o.PutToDebugLog(5,"EVENT, _dialpad Phone2Phone 1 ok");var J=G.value;var I=E.value;if(o.isNull(J)||(o.Trim(J)).length<1){o.ShowToast(l.get("p2p_err1"));return}else{J=o.Trim(J)}if(o.isNull(I)||(o.Trim(I)).length<1){o.ShowToast(l.get("p2p_err2"));return}else{I=o.Trim(I)}o.UriParser(l.get("p2p_uri"),"",J,I,"","phone2phone")});c("#adialog_negative").on("click",function(I){})}catch(D){o.PutToDebugLogException(2,"_dialpad: Phone2Phone",D)}}function e(){try{var E=o.GetDeviceWidth();if(!o.isNull(E)&&o.IsNumber(E)&&E>100){E=Math.floor(E/1.2)}else{E=220}var C='<div id="adialog_callback" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+E+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+l.get("callback")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+l.get("callback_src")+'</span><input type="text" id="callback_input" name="callback_input" data-theme="a"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+l.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+l.get("btn_cancel")+"</a></div></div>";var B=function(){};c.mobile.activePage.append(C).trigger("create");c.mobile.activePage.find(".closePopup").bind("tap",function(I){c.mobile.activePage.find(".messagePopup").popup("close")});c.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){c(this).unbind("popupafterclose").remove();c("#adialog_positive").off("click");c("#adialog_negative").off("click");B()}});var H=0;c("#adialog_callback").keypress(function(I){H++;if(I.which===13&&H<2){I.preventDefault();c("#adialog_positive").click()}else{return}});var G=document.getElementById("callback_input");if(!o.isNull(G)){G.focus()}var F=o.GetParameter("last_callback_nr");if(!o.isNull(F)&&F.length>0){G.value=F}c("#adialog_positive").on("click",function(J){o.PutToDebugLog(5,"EVENT, _dialpad Phone2Phone 1 ok");var I=G.value;if(o.isNull(I)||(o.Trim(I)).length<1){o.ShowToast(l.get("callback_src"));return}else{I=o.Trim(I)}o.UriParser(l.get("callback_uri"),"",I,"","","callback");o.SaveParameter("last_callback_nr",I)});c("#adialog_negative").on("click",function(I){})}catch(D){o.PutToDebugLogException(2,"_dialpad: Callback",D)}}function i(C){try{o.PutToDebugLog(4,"_dialpad: onStop");s.isDialpadStarted=false;document.getElementById("phone_number").value=""}catch(B){o.PutToDebugLogException(2,"_dialpad: onStop",B)}}function d(C){try{o.PutToDebugLog(4,"_dialpad: onDestroy");s.isDialpadStarted=false}catch(B){o.PutToDebugLogException(2,"_dialpad: onDestroy",B)}}return{onCreate:t,onStart:w,onStop:i,onDestroy:d}});