define(["jquery","common","stringres","global"],function(h,k,b,d){var a="";var c="";var m="";function g(s){try{k.PutToDebugLog(4,"_internalbrowser: onCreate");h(window).resize(function(){if(h.mobile.activePage.attr("id")==="page_internalbrowser"){o()}});h("#internalbrowser_menu_ul").on("click","li",function(t){i(h(this).attr("id"))});h("#btn_internalbrowser_menu").on("click",function(){q("#internalbrowser_menu_ul")});h("#btn_internalbrowser_menu").attr("title",b.get("hint_menu"));h("#btn_back_internalbrowser").on("click",function(){e()})}catch(r){k.PutToDebugLogException(2,"_internalbrowser: onCreate",r)}}function p(s){try{k.PutToDebugLog(4,"_internalbrowser: onStart");d.isInternalbrowserStarted=true;h("#page_internalbrowser_content").html("");a=k.GetIntentParam(d.intentbrowser,"url");c=k.GetIntentParam(d.intentbrowser,"lastpage");m=k.GetIntentParam(d.intentbrowser,"title");if(!k.isNull(document.getElementById("internalbrowser_title"))){if(k.isNull(m)){m=""}document.getElementById("internalbrowser_title").innerHTML=m}if(!k.isNull(document.getElementById("internalbrowser_btnback"))){document.getElementById("internalbrowser_btnback").innerHTML="<span>&LT;</span>&nbsp;"+b.get("go_back_btn_txt")}o();if(k.isNull(c)){c=""}else{c=k.Trim(c)}l()}catch(r){k.PutToDebugLogException(2,"_internalbrowser: onStart",r)}}function o(){try{h(".separator_line_thick").css("background-color",k.HoverCalc(k.getBgColor("#page_internalbrowser"),-30));var r=k.GetDeviceHeight()-h("#internalbrowser_header").height();r=r-3;r=Math.floor(r);h("#page_internalbrowser_content").height(r);h("#iframe_internalbrowser").width(k.GetDeviceWidth());h("#iframe_internalbrowser").height(r-5)}catch(s){k.PutToDebugLogException(2,"_internalbrowser: MeasureInternalbrowser",s)}}function l(){try{if(k.isNull(a)||a.length<3){k.PutToDebugLog(3,"ERROR, _internalbrowser no url to load: "+a);return}var t=k.GetDeviceWidth();var r=Math.floor(h("#page_internalbrowser_content").height()-5);var s='<iframe frameborder="0" width="'+t+'" height="'+r+'" src="'+a+'" name="iframe_internalbrowser" id="iframe_internalbrowser" style="margin:0px; padding:0px;"></iframe>';h("#page_internalbrowser_content").html(s)}catch(u){k.PutToDebugLogException(2,"_internalbrowser: OpenWebpage",u)}}var f="#menuitem_internalbrowser_close";function q(s){try{if(k.GetParameter("devicetype")===k.DEVICE_WIN_SOFTPHONE()){h("#btn_internalbrowser_menu").removeAttr("data-transition")}if(k.isNull(s)||s.lenght<1){k.PutToDebugLog(2,"ERROR, _internalbrowser: CreateOptionsMenu menuid null");return}if(h(s).length<=0){k.PutToDebugLog(2,"ERROR, _internalbrowser: CreateOptionsMenu can't get reference to Menu");return}if(s.charAt(0)!=="#"){s="#"+s}h(s).html("");h(s).append('<li id="'+f+'"><a data-rel="back">'+b.get("menu_close")+"</a></li>").listview("refresh");return true}catch(r){k.PutToDebugLogException(2,"_internalbrowser: CreateOptionsMenu",r)}return false}function i(s){try{if(k.isNull(s)||s.length<1){return}h("#internalbrowser_menu").on("popupafterclose",function(t){h("#internalbrowser_menu").off("popupafterclose");switch(s){case f:e();break}})}catch(r){k.PutToDebugLogException(2,"_internalbrowser: MenuItemSelected",r)}}function e(){try{if(c.length<2){h.mobile.back()}else{h.mobile.changePage("#"+c,{transition:"pop",role:"page"})}}catch(r){k.PutToDebugLogException(2,"_internalbrowser: CloseBrowser",r)}}function j(s){try{k.PutToDebugLog(4,"_internalbrowser: onStop");d.isInternalbrowserStarted=false;h("#page_internalbrowser_content").html("")}catch(r){k.PutToDebugLogException(2,"_internalbrowser: onStop",r)}}function n(s){try{k.PutToDebugLog(4,"_internalbrowser: onDestroy");d.isInternalbrowserStarted=false}catch(r){k.PutToDebugLogException(2,"_internalbrowser: onDestroy",r)}}return{onCreate:g,onStart:p,onStop:j,onDestroy:n}});