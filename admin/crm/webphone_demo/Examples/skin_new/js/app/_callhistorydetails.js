define(["jquery","common","stringres","global"],function(c,k,h,p){var j=-1;var w=null;function r(y){try{k.PutToDebugLog(4,"_callhistorydetails: onCreate");c(window).resize(function(){if(c.mobile.activePage.attr("id")==="page_callhistorydetails"){m()}});c("#callhistorydetails_menu_ul").on("click","li",function(z){a(c(this).attr("id"))});c("#btn_callhistorydetails_menu").on("click",function(){g("#callhistorydetails_menu_ul")});c("#btn_callhistorydetails_menu").attr("title",h.get("hint_menu"))}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: onCreate",x)}}function v(y){try{k.PutToDebugLog(4,"_callhistorydetails: onStart");p.isCallhistorydetailsStarted=true;c(".separator_line_thick").css("background-color",k.HoverCalc(k.getBgColor("#page_callhistorydetails"),-30));if(!k.isNull(document.getElementById("callhistorydetails_title"))){document.getElementById("callhistorydetails_title").innerHTML=h.get("chdetails_title")}if(!k.isNull(document.getElementById("chdetails_btnback"))){document.getElementById("chdetails_btnback").innerHTML="<span>&LT;</span>&nbsp;"+h.get("chdetails_btnback_txt")}m();try{j=k.StrToInt(k.GetIntentParam(p.intentchdetails,"ctid"))}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: onStart can't convert ctid to INT",x)}w=p.chlist[j];o()}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: onStart",x)}}function m(){try{var x=k.GetDeviceHeight()-c("#callhistorydetails_header").height();x=x-3;c("#page_callhistorydetails_content").height(x)}catch(y){k.PutToDebugLogException(2,"_callhistorylist: MeasureCallhistorydetails",y)}}function o(){try{if(k.isNull(w)||w.length<1){k.PutToDebugLog(2,"ERROR, _callhistorydetails PopulateData entry is NULL");return}c("#page_callhistorydetails_content").html("");var C='<div id="ch_contact_name">'+w[k.CH_NAME]+"</div>";var B=w[k.CH_NUMBER];var z=w[k.CH_TYPE];var y="";if(z==="0"){y=h.get("ch_outgoing")}else{if(z==="1"){y=h.get("ch_incoming")}else{y=h.get("ch_missed")}}if(!k.isNull(B)&&B.length>0){var D='<div id="ch_entry" class="ch_container"><div id="ch_call_entry" class="ch_call"><div class="ch_data"><div class="ch_type">'+y+'</div><div class="ch_number">'+w[k.CH_NUMBER]+'</div></div><div class="ch_icon"><img src="images/icon_call.png" /></div></div></div>';var x='<div id="ch_entry" class="ch_container"><div id="ch_msg_entry" class="ch_call"><div class="ch_data"><div class="ch_type">'+h.get("send_msg")+'</div><div class="ch_number">'+w[k.CH_NUMBER]+'</div></div><div class="ch_icon"><img src="images/icon_message.png" /></div></div></div>';C=C+D+x}c("#page_callhistorydetails_content").html(C);if(!k.isNull(B)&&B.length>0){c("#ch_call_entry").on("click",function(){e(true)});c("#ch_msg_entry").on("click",function(){e(false)})}}catch(A){k.PutToDebugLogException(2,"_callhistorydetails: PopulateData",A)}}function e(y){try{if(y){u()}else{b()}}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: OnItemClick",x)}}function u(){try{k.SaveParameter("redial",w[k.CH_NUMBER]);wphone.call(-1,w[k.CH_NUMBER],w[k.CH_NAME]);c.mobile.back()}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: StartCall",x)}}function b(){try{k.StartMsg(w[k.CH_NUMBER],"","_callhistorydetails")}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: StartChatSms",x)}}var l="#menuitem_callhistorydetails_create";var i="#menuitem_callhistorydetails_edit";var q="#menuitem_callhistorydetails_call";var t="#menuitem_callhistorydetails_message";function g(y){try{if(k.GetParameter("devicetype")===k.DEVICE_WIN_SOFTPHONE()){c("#btn_callhistorydetails_menu").removeAttr("data-transition")}if(k.isNull(y)||y.lenght<1){k.PutToDebugLog(2,"ERROR, _callhistorydetails: CreateOptionsMenu menuid null");return}if(c(y).length<=0){k.PutToDebugLog(2,"ERROR, _callhistorydetails: CreateOptionsMenu can't get reference to Menu");return}if(y.charAt(0)!=="#"){y="#"+y}c(y).html("");if(w[k.CH_NAME]===w[k.CH_NUMBER]){c(y).append('<li id="'+l+'"><a data-rel="back">'+h.get("menu_createcontact")+"</a></li>").listview("refresh")}else{c(y).append('<li id="'+i+'"><a data-rel="back">'+h.get("menu_editcontact")+"</a></li>").listview("refresh")}c(y).append('<li id="'+q+'"><a data-rel="back">'+h.get("menu_call")+"</a></li>").listview("refresh");c(y).append('<li id="'+t+'"><a data-rel="back">'+h.get("menu_message")+"</a></li>").listview("refresh");return true}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: CreateOptionsMenu",x)}return false}function a(y){try{if(k.isNull(y)||y.length<1){return}c("#callhistorydetails_menu").on("popupafterclose",function(z){c("#callhistorydetails_menu").off("popupafterclose");switch(y){case l:n();break;case i:s();break;case q:u();break;case t:b();break}})}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: MenuItemSelected",x)}}function n(){try{p.intentaddeditct[0]="action=add";p.intentaddeditct[1]="numbertoadd="+w[k.CH_NUMBER];c.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: CreateContact",x)}}function s(){try{var y=k.GetContactIdFromNumber(w[k.CH_NUMBER]);if(y<0){n();return}p.intentaddeditct[0]="action=edit";p.intentaddeditct[1]="ctid="+y;c.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: EditContact",x)}}function f(y){try{k.PutToDebugLog(4,"_callhistorydetails: onStop");p.isCallhistorydetailsStarted=false;c("#page_callhistorydetails_content").html("")}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: onStop",x)}}function d(y){try{k.PutToDebugLog(4,"_callhistorydetails: onDestroy");p.isCallhistorydetailsStarted=false}catch(x){k.PutToDebugLogException(2,"_callhistorydetails: onDestroy",x)}}return{onCreate:r,onStart:v,onStop:f,onDestroy:d}});