define(["jquery","common","stringres","global"],function(c,m,k,q){function r(z){try{m.PutToDebugLog(4,"_contactslist: onCreate");c("#nav_ct_dialpad").on("click",function(){c.mobile.changePage("#page_dialpad",{transition:"none",role:"page",reverse:"true"})});c("#nav_ct_callhistory").on("click",function(){c.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"})});c("#nav_ct_dialpad").attr("title",k.get("hint_dialpad"));c("#nav_ct_contacts").attr("title",k.get("hint_contacts"));c("#nav_ct_callhistory").attr("title",k.get("hint_callhistory"));c("#status_contactslist").attr("title",k.get("hint_status"));c("#curr_user_contactslist").attr("title",k.get("hint_curr_user"));c("#contactslist_list").on("click","li",function(A){b(c(this).attr("id"))});c("#contactslist_list").on("taphold","li",function(A){p(c(this).attr("id"))});c(window).resize(function(){if(c.mobile.activePage.attr("id")==="page_contactslist"){g()}});c("#contactslist_menu_ul").on("click","li",function(A){a(c(this).attr("id"))});c("#btn_contactslist_menu").on("click",function(){i("#contactslist_menu_ul")});c("#btn_contactslist_menu").attr("title",k.get("hint_menu"))}catch(y){m.PutToDebugLogException(2,"_contactslist: onCreate",y)}}function v(z){try{m.PutToDebugLog(4,"_contactslist: onStart");q.isContactslistStarted=true;if(m.GetParameter("devicetype")!==m.DEVICE_WIN_SOFTPHONE()){document.getElementById("app_name_contactslist").innerHTML=k.get("app_name")}c("#contactslist_list").attr("data-filter-placeholder",k.get("ct_search_hint"));if(!m.isNull(document.getElementById("ctlist_title"))){document.getElementById("ctlist_title").innerHTML=k.get("ctlist_title")}var A=m.GetParameter("sipusername");if(!m.isNull(A)&&A.length>0){c("#curr_user_contactslist").html(A)}c(".separator_line_thick").css("background-color",m.HoverCalc(m.getBgColor("#page_contactslist"),-30));m.ShowNotifications();g();if(m.IsIeVersion(10)){c("#contactslist_list").children().css("line-height","normal")}x()}catch(y){m.PutToDebugLogException(2,"_contactslist: onStart",y)}}function g(){try{var C=m.GetDeviceWidth()-c("#contactslist_additional_header_left").width()-c("#contactslist_additional_header_right").width();var A=m.StrToIntPx(c("#contactslist_additional_header_left").css("margin-left"));if(m.isNull(A)||A===0){A=10}A=Math.ceil(A*6);C=Math.floor(C-A)-20;c("#contactslist_notification").width(C);c("#contactslist_notification").height(Math.floor(c("#contactslist_additional_header_left").height()));var y=m.GetDeviceHeight()-c("#contactslist_header").height()-m.StrToIntPx(c(".ui-input-search").css("border-top-width"))-m.StrToIntPx(c(".ui-input-search").css("border-bottom-width"));y=y-35;var B=m.StrToIntPx(c(".ui-input-search").css("margin-top"));y=y-B-B;y=y-3;c("#contactslist_list").height(y)}catch(z){m.PutToDebugLogException(2,"_contactslist: MeasureContacslist",z)}}function x(){try{if(q.isdebugversionakos){if(m.isNull(q.ctlist)||q.ctlist.length<1){q.ctlist=[];var y=["Ambrus Akos",["40724335358","0268123456","13245679"],["home","work","other"],"0","13464346","0","0"];var B=["Ambrus Tunde",["123456","987654"],["other","fax_home"],"0","23464346","0","0"];var z=["Mariska Mari",["123456","987654"],["other","fax_home"],"0","23464346","0","0"];q.ctlist.push(y);q.ctlist.push(B);q.ctlist.push(z);for(var C=0;C<12;C++){var A=["Test_"+C,["123456_"+C,"987654_"+C],["other","fax_home"],"0","23464346","0","0"];q.ctlist.push(A)}}}if(m.isNull(q.ctlist)||q.ctlist.length<1){m.GetContacts(function(E){if(!E){m.PutToDebugLog(2,"ERROR, _contactslist: LoadContacts failed")}o()})}else{o()}}catch(D){m.PutToDebugLogException(2,"_contactslist: LoadContacts",D)}}function o(){try{if(m.isNull(document.getElementById("contactslist_list"))){m.PutToDebugLog(2,"ERROR, _contactslist: PopulateList listelement is null");return}if(m.isNull(q.ctlist)||q.ctlist.length<1){c("#contactslist_list").html('<span style="text-shadow:0 0 0;">'+k.get("no_contacts")+"</span>");m.PutToDebugLog(2,"EVENT, _contactslist: PopulateList no contacts");return}m.PutToDebugLog(2,"EVENT, _contactslist Starting populate list");var B='<li id="contact_[ID]"><a data-transition="slide">[NAME]</a></li>';var A="";for(var z=0;z<q.ctlist.length;z++){var D=q.ctlist[z];if(m.isNull(D)||D.length<1){continue}var F=D[m.CT_NAME];if(m.isNull(F)||F.length<1){var y=D[m.CT_NUMBER];if(m.isNull(y)||y.length<1||m.isNull(y[0])||y[0].length<1){continue}F=y[0]}var E=B.replace("[ID]",z);E=E.replace("[NAME]",F);A=A+E}c("#contactslist_list").html("");c("#contactslist_list").append(A).listview("refresh")}catch(C){m.PutToDebugLogException(2,"_contactslist: PopulateList",C)}}function b(B){try{if(m.isNull(B)||B.length<1){m.PutToDebugLog(2,"ERROR, _contactslist OnListItemClick id is NULL");return}var z="";var A=B.indexOf("_");if(A<2){m.PutToDebugLog(2,"ERROR, _contactslist OnListItemClick invalid id");return}z=m.Trim(B.substring(A+1));q.intentctdetails[0]="ctid="+z;c.mobile.changePage("#page_contactdetails",{transition:"none",role:"page"})}catch(y){m.PutToDebugLogException(2,"_contactslist: OnListItemClick",y)}}function p(B){try{if(m.isNull(B)||B.length<1){m.PutToDebugLog(2,"ERROR, _contactslist OnListItemLongClick id is NULL");return}var z="";var A=B.indexOf("_");if(A<2){m.PutToDebugLog(2,"ERROR, _contactslist OnListItemLongClick invalid id 1");return}z=m.Trim(B.substring(A+1));if(m.isNull(z)||z.length<1||!m.IsNumber(z)){return;m.PutToDebugLog(2,"ERROR, _contactslist OnListItemLongClick invalid id 2: "+z)}d(z)}catch(y){m.PutToDebugLogException(2,"_contactslist: OnListItemLongClick",y)}}function d(A,E){try{var y=q.ctlist[A];var C=m.GetDeviceWidth();if(!m.isNull(C)&&m.IsNumber(C)&&C>100){C=Math.floor(C/1.2)}else{C=220}var B="";var G='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>';var D="";D=G.replace("[ITEMID]","#ct_item_edit_contact");D=D.replace("[ITEMTITLE]",k.get("menu_editcontact"));B=B+D;D="";D=G.replace("[ITEMID]","#ct_item_delete_contact");D=D.replace("[ITEMTITLE]",k.get("menu_deletecontact"));B=B+D;D="";var F='<div id="ct_contextmenu" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+C+"px; min-width: "+Math.floor(C*0.6)+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+y[m.CT_NAME]+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="ct_contextmenu_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+B+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+k.get("btn_close")+"</a></div></div>";E=E?E:function(){};c.mobile.activePage.append(F).trigger("create");c.mobile.activePage.find(".closePopup").bind("tap",function(H){c.mobile.activePage.find(".messagePopup").popup("close")});c.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){c(this).unbind("popupafterclose").remove();c("#ct_contextmenu_ul").off("click","li");E()}});c("#ct_contextmenu_ul").on("click","li",function(H){var I=c(this).attr("id");if(I==="#ct_item_edit_contact"){s(A)}else{if(I==="#ct_item_delete_contact"){n(A)}}})}catch(z){m.PutToDebugLogException(2,"_contactslist: CreateContextmenu",z)}}function n(z){try{c("#ct_contextmenu").on("popupafterclose",function(A){c("#ct_contextmenu").off("popupafterclose");j(z)})}catch(y){m.PutToDebugLogException(2,"_contactslist: DeleteContact",y)}}function j(C,y){try{var B=m.GetDeviceWidth();if(!m.isNull(B)&&m.IsNumber(B)&&B>100){B=Math.floor(B/1.2)}else{B=220}var z='<div id="ct_delete_contact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+B+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+k.get("menu_deletecontact")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+k.get("contact_delete_msg")+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="#" id="btn_adialog_ok" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+k.get("btn_ok")+'</a><a href="#" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+k.get("btn_cancel")+"</a></div></div>";y=y?y:function(){};c.mobile.activePage.append(z).trigger("create");c.mobile.activePage.find(".closePopup").bind("tap",function(D){c.mobile.activePage.find(".messagePopup").popup("close")});c.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){c(this).unbind("popupbeforeposition");var D=Math.floor(m.GetDeviceHeight()*0.6);if(c(this).height()>D){c(".messagePopup .ui-content").height(D)}}});c.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){c(this).unbind("popupafterclose").remove();c("#btn_adialog_ok").off("click");y()}});c("#btn_adialog_ok").on("click",function(){q.ctlist.splice(C,1);m.SaveContactsFile(function(D){m.PutToDebugLog(4,"EVENT, _contactslist: DeleteContact SaveContactsFile: "+D.toString())});o()})}catch(A){m.PutToDebugLogException(2,"_contactdetails: DeleteContactPopup",A)}}function s(z){try{c("#ct_contextmenu").on("popupafterclose",function(A){c("#ct_contextmenu").off("popupafterclose");q.intentaddeditct[0]="action=edit";q.intentaddeditct[1]="ctid="+z;c.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})})}catch(y){m.PutToDebugLogException(2,"_contactslist: EditContact",y)}}var l="#menuitem_contactslist_settings";var w="#menuitem_contactslist_help";var u="#menuitem_contactslist_newcontact";var t="#menuitem_contactslist_exit";function i(z){try{if(m.GetParameter("devicetype")===m.DEVICE_WIN_SOFTPHONE()){c("#btn_contactslist_menu").removeAttr("data-transition")}if(m.isNull(z)||z.lenght<1){m.PutToDebugLog(2,"ERROR, _contactslist: CreateOptionsMenu menuid null");return}if(c(z).length<=0){m.PutToDebugLog(2,"ERROR, _contactslist: CreateOptionsMenu can't get reference to Menu");return}if(z.charAt(0)!=="#"){z="#"+z}c(z).html("");c(z).append('<li id="'+u+'"><a data-rel="back">'+k.get("menu_new_contact")+"</a></li>").listview("refresh");c(z).append('<li id="'+l+'"><a data-rel="back">'+k.get("settings_title")+"</a></li>").listview("refresh");c(z).append('<li id="'+w+'"><a data-rel="back">'+k.get("menu_help")+"</a></li>").listview("refresh");if(m.GetParameter("devicetype")===m.DEVICE_WIN_SOFTPHONE()){c(z).append('<li id="'+t+'"><a data-rel="back">'+k.get("menu_exit")+"</a></li>").listview("refresh")}return true}catch(y){m.PutToDebugLogException(2,"_contactslist: CreateOptionsMenu",y)}return false}function a(z){try{if(m.isNull(z)||z.length<1){return}c("#contactslist_menu").on("popupafterclose",function(A){c("#contactslist_menu").off("popupafterclose");switch(z){case u:e();break;case l:m.OpenSettings();break;case w:setTimeout(function(){m.HelpWindow("settings")},300);break;case t:m.Exit();break}})}catch(y){m.PutToDebugLogException(2,"_contactslist: MenuItemSelected",y)}}function e(){try{q.intentaddeditct[0]="action=add";c.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})}catch(y){m.PutToDebugLogException(2,"_contactslist: NewContact",y)}}function h(z){try{m.PutToDebugLog(4,"_contactslist: onStop");q.isContactslistStarted=false}catch(y){m.PutToDebugLogException(2,"_contactslist: onStop",y)}}function f(z){try{m.PutToDebugLog(4,"_contactslist: onDestroy");q.isContactslistStarted=false;m.SaveContactsFile(function(A){m.PutToDebugLog(4,"EVENT, _contactslist: onDestroy SaveContactsFile: "+A.toString())})}catch(y){m.PutToDebugLogException(2,"_contactslist: onDestroy",y)}}return{onCreate:r,onStart:v,onStop:h,onDestroy:f}});