define(["jquery","common","stringres","global"],function(e,p,m,r){var s="";var a="";var o=-1;var C="";var z=null;var i=null;var v=null;var g=null;var n=null;function t(G){try{p.PutToDebugLog(4,"_addeditcontact: onCreate");e(window).resize(function(){if(e.mobile.activePage.attr("id")==="page_addeditcontact"){A()}});e("#addeditcontact_menu_ul").on("click","li",function(H){b(e(this).attr("id"))});e("#btn_addeditcontact_menu").on("click",function(){l("#addeditcontact_menu_ul")});e("#btn_addeditcontact_menu").attr("title",m.get("hint_menu"));e("#btn_save_aec").on("click",function(){j()});e("#btn_revert_aec").on("click",function(){e.mobile.back()});e("#btn_add_aec").on("click",function(){x(null,null,true)});e("#btn_add_aec").attr("title",m.get("hint_addphone"));e(".minus_btn").attr("title",m.get("hint_removephone"));var D=e("#aec_number_fields").children().length;if(!p.isNull(D)&&D>0){for(var E=0;E<D;E++){(function(H){e("#btn_type_aec_"+H).on("click",function(){c(H,e(this).html())});e("#btn_minus_aec_"+H).on("click",function(){u(H)})}(E))}}}catch(F){p.PutToDebugLogException(2,"_addeditcontact: onCreate",F)}}function y(F){try{p.PutToDebugLog(4,"_addeditcontact: onStart");r.isAddeditcontactStarted=true;document.getElementById("aec_label_name").innerHTML=m.get("contact_name");e("#aec_firstname").attr("placeholder",m.get("contact_firstname"));e("#aec_lastname").attr("placeholder",m.get("contact_lastname"));document.getElementById("aec_label_phone").innerHTML=m.get("contact_phone");document.getElementById("btn_save_aec").innerHTML=m.get("btn_save");document.getElementById("btn_revert_aec").innerHTML=m.get("btn_revert");e("#addeditcontact_list").attr("data-filter-placeholder",m.get("ct_search_hint"));e(".separator_line_thick").css("background-color",p.HoverCalc(p.getBgColor("#page_addeditcontact"),-30));if(!p.isNull(document.getElementById("addeditct_btnback"))){document.getElementById("addeditct_btnback").innerHTML="<span>&LT;</span>&nbsp;"+m.get("btn_cancel")}A();setTimeout(function(){A()},1000);s=p.GetIntentParam(r.intentaddeditct,"action");if(!p.isNull(s)&&s.length>0){if(s==="add"){a=p.GetIntentParam(r.intentaddeditct,"numbertoadd");document.getElementById("addeditct_title").innerHTML=m.get("addeditct_title_new")}else{if(s==="edit"){try{o=p.StrToInt(p.GetIntentParam(r.intentaddeditct,"ctid"))}catch(E){p.PutToDebugLogException(2,"_addeditcontact: onStart can't convert contact id",E)}v=r.ctlist[o];g=v[p.CT_NUMBER];n=v[p.CT_PTYPE];document.getElementById("addeditct_title").innerHTML=m.get("addeditct_title_edit")}else{e.mobile.back()}}}if(!p.isNull(v)&&v.length>0){C=v[p.CT_NAME]}z=document.getElementById("aec_firstname");i=document.getElementById("aec_lastname");if(s==="add"&&!p.isNull(z)){z.focus()}q()}catch(D){p.PutToDebugLogException(2,"_addeditcontact: onStart",D)}}function A(){try{var D=p.GetDeviceHeight()-e("#addeditcontact_header").height()-e("#aec_footer").height();D=D-3;e("#page_addeditcontact_content").height(D)}catch(E){p.PutToDebugLogException(2,"_addeditcontact: MeasureAddeditcontact",E)}}function q(){try{if(s==="add"){if(!p.isNull(a)&&a.length>0){x("",p.Trim(a),false)}else{x("","",false)}}else{if(s==="edit"){var H=C.indexOf(" ");if(H>0){z.value=p.Trim(C.substring(0,H));i.value=p.Trim(C.substring(H+1,C.length))}else{z.value=p.Trim(C)}if(o<0){p.PutToDebugLog(2,"ERROR, _addeditcontact PopulateData incorrect ctid");return}if(p.isNull(g)||g.length<1){return}var G=e("#aec_number_fields").children().length;for(var D=0;D<g.length;D++){if(D>=G){break}var F="";if(!p.isNull(n[D])){F=n[D]}x(F,g[D],false)}}}}catch(E){p.PutToDebugLogException(2,"_addeditcontact: PopulateData",E)}}function x(G,I,K){try{if(K){p.PutToDebugLog(5,"EVENT, _addeditcontact: AddPhoneField on click")}if(p.isNull(G)||G.length<3){G="mobile"}if(p.isNull(I)){I=""}var D=e("#aec_number_fields").children().length;var J=e("#aec_number_fields").children();if(p.isNull(D)||D<1){return}for(var F=0;F<D;F++){var E=document.getElementById("aec_entry_"+F);if(!p.isNull(E)&&E.style.display==="none"){E.style.display="block";e("#btn_type_aec_"+F).html(m.get(G));e("#number_aec_"+F).val(I);if(K){e("#btn_type_aec_"+F).click()}break}}}catch(H){p.PutToDebugLogException(2,"_addeditcontact: AddPhoneField",H)}}function c(D,M,O){try{var N=p.GetDeviceWidth();if(!p.isNull(N)&&p.IsNumber(N)&&N>100){N=Math.floor(N/1.2)}else{N=220}var I="";var E="";var J="";var F="";var K="";var L="";var R="";var Q="";if(!p.isNull(M)&&M.length>0){if(M===m.get("home")){I='checked="checked"'}if(M===m.get("mobile")){E='checked="checked"'}if(M===m.get("work")){J='checked="checked"'}if(M===m.get("other")){F='checked="checked"'}if(M===m.get("fax_home")){K='checked="checked"'}if(M===m.get("fax_work")){L='checked="checked"'}if(M===m.get("pager")){R='checked="checked"'}if(M===m.get("sip")){Q='checked="checked"'}}else{E='checked="checked"'}var H='<form><fieldset data-role="controlgroup"><input name="phone_type" id="radio_home" value="on" '+I+' type="radio"><label for="radio_home">'+m.get("home")+'</label><input name="phone_type" id="radio_mobile" value="on" '+E+' type="radio"><label for="radio_mobile">'+m.get("mobile")+'</label><input name="phone_type" id="radio_work" value="on" '+J+' type="radio"><label for="radio_work">'+m.get("work")+'</label><input name="phone_type" id="radio_other" value="on" '+F+' type="radio"><label for="radio_other">'+m.get("other")+'</label><input name="phone_type" id="radio_fax_home" value="on" '+K+' type="radio"><label for="radio_fax_home">'+m.get("fax_home")+'</label><input name="phone_type" id="radio_fax_work" value="on" '+L+' type="radio"><label for="radio_fax_work">'+m.get("fax_work")+'</label><input name="phone_type" id="radio_pager" value="on" '+R+' type="radio"><label for="radio_pager">'+m.get("pager")+'</label><input name="phone_type" id="radio_sip" value="on" '+Q+' type="radio"><label for="radio_sip">'+m.get("sip")+"</label></fieldset></form>";var P='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+N+"px; min-width: "+Math.floor(N*0.6)+'px;"><div data-role="header" data-theme="b"><a href="#" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+m.get("contact_alert_title")+'</h1></div><div role="main" class="ui-content">'+H+"</div></div>";O=O?O:function(){};e.mobile.activePage.append(P).trigger("create");e.mobile.activePage.find(".closePopup").bind("tap",function(S){e.mobile.activePage.find(".messagePopup").popup("close")});e.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){e(this).unbind("popupafterclose").remove();O()}});e(":radio").on("change",function(T){e.mobile.activePage.find(".messagePopup").popup("close");var S=e(this).attr("id");if(p.isNull(S)||S.length<1){return}var U=S.indexOf("_");if(U>0&&U<S.length){S=S.substring(U+1)}e("#btn_type_aec_"+D).html(m.get(S))})}catch(G){p.PutToDebugLogException(2,"_addeditcontact: ChooseType",G)}}function u(F){try{var E=document.getElementById("aec_entry_"+F);if(!p.isNull(E)){E.style.display="none"}}catch(D){p.PutToDebugLogException(2,"_addeditcontact: RemoveEntry",D)}}function j(){try{if(s==="add"){w()}else{if(s==="edit"){d()}else{return}}}catch(D){p.PutToDebugLogException(2,"_addeditcontact: SaveContact",D)}}function d(){try{var P=z.value;var Q=i.value;if((p.isNull(P)||(p.Trim(P)).length<1)&&(p.isNull(Q)||(p.Trim(Q)).length<1)){p.AlertDialog(m.get("contact_name"),m.get("warning_msg_3"));return}var F="";if(!p.isNull(P)&&P.length>0){F=F+P+" "}if(!p.isNull(Q)&&Q.length>0){F=F+Q}F=p.Trim(F);var D=e("#aec_number_fields").children().length;if(p.isNull(D)||D<1){p.PutToDebugLog(2,"ERROR, SaveEditedContact fieldcount is null");return}var R=[];var J=[];var N=0;for(var H=0;H<D;H++){var E=document.getElementById("aec_entry_"+H);var M=e("#number_aec_"+H).val();var I=e("#btn_type_aec_"+H).html();var L=m.get("mobile");if(p.isNull(E)||E.style.display==="none"){continue}if(p.isNull(M)||(p.Trim(M)).length<1){continue}if(I===m.get("home")){L="home"}if(I===m.get("mobile")){L="mobile"}if(I===m.get("work")){L="work"}if(I===m.get("other")){L="other"}if(I===m.get("fax_home")){L="fax_home"}if(I===m.get("fax_work")){L="fax_work"}if(I===m.get("pager")){L="pager"}if(I===m.get("sip")){L="sip"}R[N]=M;J[N]=L;N++}if(p.isNull(R)||R.length<1){p.ShowToast(m.get("contact_no_nunber"));return}var O=(p.GetTickCount()).toString();var K=[];K[p.CT_NAME]=F;K[p.CT_NUMBER]=R;K[p.CT_PTYPE]=J;K[p.CT_USAGE]=v[p.CT_USAGE];K[p.CT_LASTMODIF]=O;K[p.CT_DELFLAG]=v[p.CT_DELFLAG];K[p.CT_FAV]=v[p.CT_FAV];r.ctlist[o]=K;r.wasCtModified=true;p.SortContacts();p.ShowToast(m.get("contact_saved"));e.mobile.back();return}catch(G){p.PutToDebugLogException(2,"_addeditcontact: SaveEditedContact",G)}try{p.ShowToast(m.get("contact_save_error"));e.mobile.back()}catch(G){}}function w(){try{var P=z.value;var Q=i.value;if((p.isNull(P)||(p.Trim(P)).length<1)&&(p.isNull(Q)||(p.Trim(Q)).length<1)){p.AlertDialog(m.get("contact_name"),m.get("warning_msg_3"));return}var E="";if(!p.isNull(P)&&P.length>0){E=E+P+" "}if(!p.isNull(Q)&&Q.length>0){E=E+Q}E=p.Trim(E);var D=e("#aec_number_fields").children().length;if(p.isNull(D)||D<1){p.PutToDebugLog(2,"ERROR, SaveNewContact fieldcount is null");return}var R=[];var I=[];var N=0;for(var G=0;G<D;G++){var M=e("#number_aec_"+G).val();var H=e("#btn_type_aec_"+G).html();var L=m.get("mobile");if(p.isNull(M)||(p.Trim(M)).length<1){continue}if(H===m.get("home")){L="home"}if(H===m.get("mobile")){L="mobile"}if(H===m.get("work")){L="work"}if(H===m.get("other")){L="other"}if(H===m.get("fax_home")){L="fax_home"}if(H===m.get("fax_work")){L="fax_work"}if(H===m.get("pager")){L="pager"}if(H===m.get("sip")){L="sip"}R[N]=M;I[N]=L;N++}if(p.isNull(R)||R.length<1){p.ShowToast(m.get("contact_no_nunber"));return}var O=(p.GetTickCount()).toString();var J=[];J[p.CT_NAME]=E;J[p.CT_NUMBER]=R;J[p.CT_PTYPE]=I;J[p.CT_USAGE]="0";J[p.CT_LASTMODIF]=O;J[p.CT_DELFLAG]="0";J[p.CT_FAV]="0";r.ctlist.push(J);r.wasCtModified=true;p.SortContacts();p.ShowToast(m.get("contact_saved"));e.mobile.back();return}catch(F){p.PutToDebugLogException(2,"_addeditcontact: SaveEditedContact",F)}try{p.ShowToast(m.get("contact_save_error"));e.mobile.back()}catch(K){}}var h="#menuitem_addeditcontact_save";var B="#menuitem_addeditcontact_revert";function l(E){try{if(p.GetParameter("devicetype")===p.DEVICE_WIN_SOFTPHONE()){e("#btn_addeditcontact_menu").removeAttr("data-transition")}if(p.isNull(E)||E.lenght<1){p.PutToDebugLog(2,"ERROR, _addeditcontact: CreateOptionsMenu menuid null");return}if(e(E).length<=0){p.PutToDebugLog(2,"ERROR, _addeditcontact: CreateOptionsMenu can't get reference to Menu");return}if(E.charAt(0)!=="#"){E="#"+E}e(E).html("");e(E).append('<li id="'+h+'"><a data-rel="back">'+m.get("btn_save")+"</a></li>").listview("refresh");e(E).append('<li id="'+B+'"><a data-rel="back">'+m.get("btn_revert")+"</a></li>").listview("refresh");return true}catch(D){p.PutToDebugLogException(2,"_addeditcontact: CreateOptionsMenu",D)}return false}function b(E){try{if(p.isNull(E)||E.length<1){return}e("#addeditcontact_menu").on("popupafterclose",function(F){e("#addeditcontact_menu").off("popupafterclose");switch(E){case h:j();break;case B:e.mobile.back();break}})}catch(D){p.PutToDebugLogException(2,"_addeditcontact: MenuItemSelected",D)}}function k(H){try{p.PutToDebugLog(4,"_addeditcontact: onStop");r.isAddeditcontactStarted=false;var D=e("#aec_number_fields").children().length;if(p.isNull(D)||D<1){return}for(var F=0;F<D;F++){var E=document.getElementById("aec_entry_"+F);if(!p.isNull(E)){E.style.display="none"}}}catch(G){p.PutToDebugLogException(2,"_addeditcontact: onStop",G)}}function f(E){try{p.PutToDebugLog(4,"_addeditcontact: onDestroy");r.isAddeditcontactStarted=false;if(!p.isNull(z)){z.value=""}if(!p.isNull(i)){i.value=""}}catch(D){p.PutToDebugLogException(2,"_addeditcontact: onDestroy",D)}}return{onCreate:t,onStart:y,onStop:k,onDestroy:f}});